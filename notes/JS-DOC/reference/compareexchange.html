<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>compareexchange</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
</head>
<body>
<h1 id="atomics.compareexchange">Atomics.compareExchange()</h1>
<p>The static <code>Atomics``.compareExchange()</code> method exchanges a given replacement value at a given position in the array, if a given expected value equals the old value. It returns the old value at that position whether it was equal to the expected value or not. This atomic operation guarantees that no other write happens until the modified value is written back.</p>
<h2 id="syntax">Syntax</h2>
<pre><code>Atomics.compareExchange(typedArray, index, expectedValue, replacementValue)</code></pre>
<h3 id="parameters">Parameters</h3>
<p><code>typedArray</code><br />
An integer typed array. One of <a href="../int8array"><code>Int8Array</code></a>, <a href="../uint8array"><code>Uint8Array</code></a>, <a href="../int16array"><code>Int16Array</code></a>, <a href="../uint16array"><code>Uint16Array</code></a>, <a href="../int32array"><code>Int32Array</code></a>, <a href="../uint32array"><code>Uint32Array</code></a>, <a href="../bigint64array"><code>BigInt64Array</code></a>, or <a href="../biguint64array"><code>BigUint64Array</code></a>.</p>
<p><code>index</code><br />
The position in the <code>typedArray</code> to exchange a <code>value</code>.</p>
<p><code>expectedValue</code><br />
The value to check for equality.</p>
<p><code>replacementValue</code><br />
The number to exchange.</p>
<h3 id="return-value">Return value</h3>
<p>The old value at the given position (<code>typedArray[index]</code>).</p>
<h3 id="exceptions">Exceptions</h3>
<ul>
<li>Throws a <a href="../typeerror"><code>TypeError</code></a>, if <code>typedArray</code> is not one of the allowed integer types.</li>
<li>Throws a <a href="../rangeerror"><code>RangeError</code></a>, if <code>index</code> is out of bounds in the <code>typedArray</code>.</li>
</ul>
<h2 id="examples">Examples</h2>
<h3 id="using-compareexchange">Using compareExchange()</h3>
<pre><code>const sab = new SharedArrayBuffer(1024);
const ta = new Uint8Array(sab);
ta[0] = 7;

Atomics.compareExchange(ta, 0, 7, 12); // returns 7, the old value
Atomics.load(ta, 0); // 12</code></pre>
<h2 id="specifications">Specifications</h2>
<table>
<thead>
<tr class="header">
<th>
Specification
</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>
<p><a href="https://tc39.es/ecma262/#sec-atomics.compareexchange">ECMAScript Language Specification (ECMAScript) <br/></p>
<span class="small">#sec-atomics.compareexchange</span></a>
</td>
</tr>
</tbody>
</table>
<p><code>compareExchange</code></p>
<p>68</p>
<p>60-63</p>
<p>Chrome disabled <code>SharedArrayBuffer</code> on January 5, 2018 to help reduce the efficacy of <a href="https://www.chromium.org/Home/chromium-security/ssca">speculative side-channel attacks</a>. This was a temporary removal while mitigations were put in place.</p>
<p>79</p>
<p>16-17</p>
<p>Support was removed to mitigate <a href="https://blogs.windows.com/msedgedev/2018/01/03/speculative-execution-mitigations-microsoft-edge-internet-explorer">speculative execution side-channel attacks (Windows blog)</a>.</p>
<p>78</p>
<p>57</p>
<p>Support was disabled by default to mitigate <a href="https://blog.mozilla.org/security/2018/01/03/mitigations-landing-new-class-timing-attack/">speculative execution side-channel attacks (Mozilla Security Blog)</a>.</p>
<p>55-57</p>
<p>46-55</p>
<p>No</p>
<p>No</p>
<p>10.1-11.1</p>
<p>60-63</p>
<p>Chrome disabled <code>SharedArrayBuffer</code> on January 5, 2018 to help reduce the efficacy of <a href="https://www.chromium.org/Home/chromium-security/ssca">speculative side-channel attacks</a>. This is intended as a temporary measure until other mitigations are in place.</p>
<p>60-63</p>
<p>Chrome disabled <code>SharedArrayBuffer</code> on January 5, 2018 to help reduce the efficacy of <a href="https://www.chromium.org/Home/chromium-security/ssca">speculative side-channel attacks</a>. This is intended as a temporary measure until other mitigations are in place.</p>
<p>57</p>
<p>Support was disabled by default to mitigate <a href="https://blog.mozilla.org/security/2018/01/03/mitigations-landing-new-class-timing-attack/">speculative execution side-channel attacks (Mozilla Security Blog)</a>.</p>
<p>55-57</p>
<p>46-55</p>
<p>No</p>
<p>10.3-11.3</p>
<p>No</p>
<p>Chrome disabled <code>SharedArrayBuffer</code> on January 5, 2018 to help reduce the efficacy of <a href="https://www.chromium.org/Home/chromium-security/ssca">speculative side-channel attacks</a>. This is intended as a temporary measure until other mitigations are in place.</p>
<h2 id="see-also">See also</h2>
<ul>
<li><a href="../atomics"><code>Atomics</code></a></li>
<li><a href="exchange"><code>Atomics.exchange()</code></a></li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Atomics/compareExchange" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Atomics/compareExchange</a></p>
</body>
</html>
