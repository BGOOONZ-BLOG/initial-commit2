<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>protocolsforthe</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<p>title: Protocols for the Brave tip-number: 73 tip-username: loverajoel tip-username-profile: https://github.com/loverajoel tip-tldr: You might have heard about the old ways gaining hype recently, and we don’t mean praying to the gods of the north. Today we’re introducing a feature found in Clojure which allows you to define interfaces for your classes.</p>
<p>categories: - en - javascript</p>
<hr />
<p>You might have heard about the old ways gaining hype recently, and we don’t mean praying to the gods of the north.</p>
<p>Functional programming is the rediscovered toy which is bringing some sanity to the world of mutable state and global bindings.</p>
<p>Today we’re introducing a feature found in Clojure which allows you to define interfaces for your classes. Let’s look at one-off implementation:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">const</span> protocols <span class="op">=</span> (...<span class="at">ps</span>) <span class="kw">=&gt;</span> <span class="va">ps</span>.<span class="at">reduce</span>((c<span class="op">,</span> p) <span class="kw">=&gt;</span> <span class="at">p</span>(c)<span class="op">,</span> Object)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">const</span> Mappable <span class="op">=</span> (klass) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="cf">return</span> <span class="kw">class</span> <span class="kw">extends</span> klass <span class="op">{</span></a>
<a class="sourceLine" id="cb1-5" title="5">        <span class="at">map</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb1-6" title="6">            <span class="cf">throw</span> <span class="st">&#39;Not implemented&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-7" title="7">        <span class="op">}</span></a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="op">};</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="op">};</span></a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">const</span> Foldable <span class="op">=</span> (klass) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-12" title="12">    <span class="cf">return</span> <span class="kw">class</span> <span class="kw">extends</span> klass <span class="op">{</span></a>
<a class="sourceLine" id="cb1-13" title="13">        <span class="at">fold</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb1-14" title="14">            <span class="cf">throw</span> <span class="st">&#39;Not implemented&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-15" title="15">        <span class="op">}</span></a>
<a class="sourceLine" id="cb1-16" title="16">    <span class="op">};</span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="op">};</span></a>
<a class="sourceLine" id="cb1-18" title="18"></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="kw">class</span> NaturalNumbers <span class="kw">extends</span> <span class="at">protocols</span>(Mappable<span class="op">,</span> Foldable) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-20" title="20">    <span class="at">constructor</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb1-21" title="21">        <span class="kw">super</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb1-22" title="22">        <span class="kw">this</span>.<span class="at">elements</span> <span class="op">=</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb1-23" title="23">    <span class="op">}</span></a>
<a class="sourceLine" id="cb1-24" title="24"></a>
<a class="sourceLine" id="cb1-25" title="25">    <span class="at">map</span>(f) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-26" title="26">        <span class="cf">return</span> <span class="kw">this</span>.<span class="va">elements</span>.<span class="at">map</span>(f)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-27" title="27">    <span class="op">}</span></a>
<a class="sourceLine" id="cb1-28" title="28"></a>
<a class="sourceLine" id="cb1-29" title="29">    <span class="at">fold</span>(f) <span class="op">{</span></a>
<a class="sourceLine" id="cb1-30" title="30">        <span class="cf">return</span> <span class="kw">this</span>.<span class="va">elements</span>.<span class="at">reduce</span>(f<span class="op">,</span> <span class="kw">this</span>.<span class="at">elements</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-31" title="31">    <span class="op">}</span></a>
<a class="sourceLine" id="cb1-32" title="32"><span class="op">}</span></a></code></pre></div>
<p>Yes, we’re building a chain of class inheritance up there with that reduce boy. It’s pretty cool. We’re doing it dynamically! You see, each protocol receives a base class (Object) and extends it somehow returning the new class. The idea is similar to that of interfaces.</p>
<p>We supply method signatures for the protocol and make sure we provide implementations for it on our base classes.</p>
<p>What’s so cool about it? We get to write things like these:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">const</span> map <span class="op">=</span> (f) <span class="kw">=&gt;</span> (o) <span class="kw">=&gt;</span> <span class="va">o</span>.<span class="at">map</span>(f)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">const</span> fold <span class="op">=</span> (f) <span class="kw">=&gt;</span> (o) <span class="kw">=&gt;</span> <span class="va">o</span>.<span class="at">fold</span>(f)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">const</span> compose <span class="op">=</span> (...<span class="at">fns</span>) <span class="kw">=&gt;</span> <span class="va">fns</span>.<span class="at">reduce</span>((acc<span class="op">,</span> f) <span class="kw">=&gt;</span> (x) <span class="kw">=&gt;</span> <span class="at">acc</span>(<span class="at">f</span>(x))<span class="op">,</span> id)<span class="op">;</span></a></code></pre></div>
<p>Ok, maybe we could have written those two functions without the above fuzz but, now that we know <code>NaturalNumbers</code> are <code>Mappable</code>, we can call <code>map</code> on them and trust it will return the right result. Furthermore, with our third function, we can <em>compose</em> any number of operations defined in protocols cleanly:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> plus1 <span class="op">=</span> (x) <span class="kw">=&gt;</span> x <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">const</span> div5 <span class="op">=</span> (x) <span class="kw">=&gt;</span> x / <span class="dv">5</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">const</span> plus_then_div <span class="op">=</span> <span class="at">compose</span>(<span class="at">map</span>(div5)<span class="op">,</span> <span class="at">map</span>(plus1))<span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="va">console</span>.<span class="at">log</span>(<span class="at">plus_then_div</span>(<span class="kw">new</span> <span class="at">NaturalNumbers</span>()))<span class="op">;</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co">// =&gt; [ 0.4, 0.6, 0.8, 1, 1.2, 1.4, 1.6, 1.8, 2 ]</span></a></code></pre></div>
<p>More important, if we know that an object of ours is <code>Mappable</code>, we know <code>map</code> will work on it. Protocols gives us an idea of what we can do with an object and help us abstract common operations between data types, thus reducing the overhead of dealing with a hundred functions.</p>
<p>What is easier? To have a hundred functions for every different object or ten functions that work on a hundred objects?</p>
</body>
</html>
