<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>immutablestructuresandcloning</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<hr />
<p>Object cloning is a tricky, full of edge-cases, endeavor. The reason is simple enough. Objects maintain internal state, and that is much abused. There are countless techniques, or better phrased, countless derivations of the same technique.</p>
<p>Cloning an object is an indicator that your application is growing, and that you’ve got a complex object which you’d want to treat as an immutable value, i.e operate on it while maintaining a previous state.</p>
<p>If the object is in your control, you’re lucky. A bit of refactoring here and there might lead you to a point where you avoid the problem entirely by rethinking your object’s structure and behavior.</p>
<p>With the rediscovering of functional programming techniques, a myriad of debates have been held about immutable structures and how they offer exactly what you seek for. Mutable state is the root of all evil, some might argue.</p>
<p>We encourage to reach <strong>ImmutableJS</strong> by Facebook which provides a nice set of immutable structures free for use. By rethinking your object’s inner workings and separating state from behavior, making each function consume a state to produce a new one - much like the Haskell’s <strong>State</strong> monad - you will reduce many nuisances.</p>
<p>If the object is outside your control, you’re partly out of luck. This can be circumvented by creating convoluted computations where you solve for yourself circular references and reach enlightenment. However, as you’re using external objects anyways, and they must come, as their name says, from external sources, then you might be more comfortable handling the matter to yet another external library and focus on what matters the most, i.e, your application itself.</p>
<p>One such library is <a href="https://github.com/pvorb/clone">pvorb/clone</a>, which has a very simple API. To clone an object you only have to</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">var</span> clone <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;clone&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">var</span> a <span class="op">=</span> <span class="op">{</span> <span class="dt">foo</span><span class="op">:</span> <span class="op">{</span> <span class="dt">bar</span><span class="op">:</span> <span class="st">&#39;baz&#39;</span> <span class="op">}</span> <span class="op">};</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">var</span> b <span class="op">=</span> <span class="at">clone</span>(a)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="va">a</span>.<span class="va">foo</span>.<span class="at">bar</span> <span class="op">=</span> <span class="st">&#39;foo&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="va">console</span>.<span class="at">log</span>(a)<span class="op">;</span> <span class="co">// {foo: {bar: &#39;foo&#39;}}</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="va">console</span>.<span class="at">log</span>(b)<span class="op">;</span> <span class="co">// {foo: {bar: &#39;baz&#39;}}</span></a></code></pre></div>
<p>There are, of course, many more libraries that allow you to do the same such as <a href="http://ramdajs.com/docs/#clone">Ramda</a>, <a href="https://www.npmjs.com/package/lodash.clonedeep">lodash.clonedeep</a> and <a href="https://www.npmjs.com/package/lodash.clone">lodash.clone</a>.</p>
<p>As an end note, if you are serious about dealing with immutable structures, you might want to check <strong>ClojureScript</strong> or (for those that feel that Haskell’s worth a shot) <strong>PureScript</strong>.</p>
<p>We neither encourage, nor condemn, the use of self made cloning mechanisms. Only noting that considerable work has been done on the area and that you’d probably be better of reusing than reinventing the wheel.</p>
</body>
</html>
