{"expireTime":9007200904306547000,"key":"transformer-remark-markdown-ast-eba99359a437b050d9c722e5e9bd1b0f--","val":{"type":"root","children":[{"type":"heading","depth":3,"children":[{"type":"text","value":"Anonymous Closures","position":{"start":{"line":3,"column":5,"offset":6},"end":{"line":3,"column":23,"offset":24},"indent":[]}}],"position":{"start":{"line":3,"column":1,"offset":2},"end":{"line":3,"column":23,"offset":24},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This is the fundamental construct that makes it all possible, and really is the single ","position":{"start":{"line":5,"column":1,"offset":26},"end":{"line":5,"column":88,"offset":113},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"best feature of JavaScript","position":{"start":{"line":5,"column":90,"offset":115},"end":{"line":5,"column":116,"offset":141},"indent":[]}}],"position":{"start":{"line":5,"column":88,"offset":113},"end":{"line":5,"column":118,"offset":143},"indent":[]}},{"type":"text","value":". We'll simply create an anonymous function, and execute it immediately. All of the code that runs inside the function lives in a ","position":{"start":{"line":5,"column":118,"offset":143},"end":{"line":5,"column":248,"offset":273},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"closure","position":{"start":{"line":5,"column":250,"offset":275},"end":{"line":5,"column":257,"offset":282},"indent":[]}}],"position":{"start":{"line":5,"column":248,"offset":273},"end":{"line":5,"column":259,"offset":284},"indent":[]}},{"type":"text","value":", which provides ","position":{"start":{"line":5,"column":259,"offset":284},"end":{"line":5,"column":276,"offset":301},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"privacy","position":{"start":{"line":5,"column":278,"offset":303},"end":{"line":5,"column":285,"offset":310},"indent":[]}}],"position":{"start":{"line":5,"column":276,"offset":301},"end":{"line":5,"column":287,"offset":312},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":5,"column":287,"offset":312},"end":{"line":5,"column":292,"offset":317},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"state","position":{"start":{"line":5,"column":294,"offset":319},"end":{"line":5,"column":299,"offset":324},"indent":[]}}],"position":{"start":{"line":5,"column":292,"offset":317},"end":{"line":5,"column":301,"offset":326},"indent":[]}},{"type":"text","value":" throughout the lifetime of our application.","position":{"start":{"line":5,"column":301,"offset":326},"end":{"line":5,"column":345,"offset":370},"indent":[]}}],"position":{"start":{"line":5,"column":1,"offset":26},"end":{"line":5,"column":345,"offset":370},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"(function () {\n    // ... all vars and functions are in this scope only\n    // still maintains access to all globals\n})();","position":{"start":{"line":7,"column":1,"offset":372},"end":{"line":12,"column":4,"offset":504},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Notice the ","position":{"start":{"line":14,"column":1,"offset":506},"end":{"line":14,"column":12,"offset":517},"indent":[]}},{"type":"inlineCode","value":"()","position":{"start":{"line":14,"column":12,"offset":517},"end":{"line":14,"column":16,"offset":521},"indent":[]}},{"type":"text","value":" around the anonymous function. This is required by the language, since statements that begin with the token ","position":{"start":{"line":14,"column":16,"offset":521},"end":{"line":14,"column":125,"offset":630},"indent":[]}},{"type":"inlineCode","value":"function","position":{"start":{"line":14,"column":125,"offset":630},"end":{"line":14,"column":135,"offset":640},"indent":[]}},{"type":"text","value":" are always considered to be ","position":{"start":{"line":14,"column":135,"offset":640},"end":{"line":14,"column":164,"offset":669},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"function declarations","position":{"start":{"line":14,"column":166,"offset":671},"end":{"line":14,"column":187,"offset":692},"indent":[]}}],"position":{"start":{"line":14,"column":164,"offset":669},"end":{"line":14,"column":189,"offset":694},"indent":[]}},{"type":"text","value":". Including ","position":{"start":{"line":14,"column":189,"offset":694},"end":{"line":14,"column":201,"offset":706},"indent":[]}},{"type":"inlineCode","value":"()","position":{"start":{"line":14,"column":201,"offset":706},"end":{"line":14,"column":205,"offset":710},"indent":[]}},{"type":"text","value":" creates a ","position":{"start":{"line":14,"column":205,"offset":710},"end":{"line":14,"column":216,"offset":721},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"function expression","position":{"start":{"line":14,"column":218,"offset":723},"end":{"line":14,"column":237,"offset":742},"indent":[]}}],"position":{"start":{"line":14,"column":216,"offset":721},"end":{"line":14,"column":239,"offset":744},"indent":[]}},{"type":"text","value":" instead.","position":{"start":{"line":14,"column":239,"offset":744},"end":{"line":14,"column":248,"offset":753},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":506},"end":{"line":14,"column":248,"offset":753},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Global Import","position":{"start":{"line":16,"column":5,"offset":759},"end":{"line":16,"column":18,"offset":772},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":755},"end":{"line":16,"column":18,"offset":772},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"JavaScript has a feature known as ","position":{"start":{"line":18,"column":1,"offset":774},"end":{"line":18,"column":35,"offset":808},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"implied globals","position":{"start":{"line":18,"column":37,"offset":810},"end":{"line":18,"column":52,"offset":825},"indent":[]}}],"position":{"start":{"line":18,"column":35,"offset":808},"end":{"line":18,"column":54,"offset":827},"indent":[]}},{"type":"text","value":". Whenever a name is used, the interpreter walks the scope chain backwards looking for a ","position":{"start":{"line":18,"column":54,"offset":827},"end":{"line":18,"column":143,"offset":916},"indent":[]}},{"type":"inlineCode","value":"var","position":{"start":{"line":18,"column":143,"offset":916},"end":{"line":18,"column":148,"offset":921},"indent":[]}},{"type":"text","value":" statement for that name. If none is found, that variable is assumed to be global. If it's used in an assignment, the global is created if it doesn't already exist. This means that using or creating global variables in an anonymous closure is easy. Unfortunately, this leads to hard-to-manage code, as it's not obvious (to humans) which variables are global in a given file.","position":{"start":{"line":18,"column":148,"offset":921},"end":{"line":18,"column":522,"offset":1295},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":774},"end":{"line":18,"column":522,"offset":1295},"indent":[]}},{"type":"heading","depth":6,"children":[{"type":"text","value":"Luckily, our anonymous function provides an easy alternative. By passing globals as parameters to our anonymous function, we ","position":{"start":{"line":20,"column":8,"offset":1304},"end":{"line":20,"column":133,"offset":1429},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"import","position":{"start":{"line":20,"column":135,"offset":1431},"end":{"line":20,"column":141,"offset":1437},"indent":[]}}],"position":{"start":{"line":20,"column":133,"offset":1429},"end":{"line":20,"column":143,"offset":1439},"indent":[]}},{"type":"text","value":" them into our code, which is both ","position":{"start":{"line":20,"column":143,"offset":1439},"end":{"line":20,"column":178,"offset":1474},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"clearer","position":{"start":{"line":20,"column":180,"offset":1476},"end":{"line":20,"column":187,"offset":1483},"indent":[]}}],"position":{"start":{"line":20,"column":178,"offset":1474},"end":{"line":20,"column":189,"offset":1485},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":20,"column":189,"offset":1485},"end":{"line":20,"column":194,"offset":1490},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"faster","position":{"start":{"line":20,"column":196,"offset":1492},"end":{"line":20,"column":202,"offset":1498},"indent":[]}}],"position":{"start":{"line":20,"column":194,"offset":1490},"end":{"line":20,"column":204,"offset":1500},"indent":[]}},{"type":"text","value":" than implied globals. Here's an example:","position":{"start":{"line":20,"column":204,"offset":1500},"end":{"line":20,"column":245,"offset":1541},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":1297},"end":{"line":20,"column":245,"offset":1541},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"(function ($, YAHOO) {\n// now have access to globals jQuery (as $) and YAHOO in this code\n}(jQuery, YAHOO));","position":{"start":{"line":22,"column":1,"offset":1543},"end":{"line":26,"column":4,"offset":1659},"indent":[1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Module Export","position":{"start":{"line":28,"column":5,"offset":1665},"end":{"line":28,"column":18,"offset":1678},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":1661},"end":{"line":28,"column":18,"offset":1678},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Sometimes you don't just want to ","position":{"start":{"line":30,"column":1,"offset":1680},"end":{"line":30,"column":34,"offset":1713},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"use","position":{"start":{"line":30,"column":35,"offset":1714},"end":{"line":30,"column":38,"offset":1717},"indent":[]}}],"position":{"start":{"line":30,"column":34,"offset":1713},"end":{"line":30,"column":39,"offset":1718},"indent":[]}},{"type":"text","value":" globals, but you want to ","position":{"start":{"line":30,"column":39,"offset":1718},"end":{"line":30,"column":65,"offset":1744},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"declare","position":{"start":{"line":30,"column":66,"offset":1745},"end":{"line":30,"column":73,"offset":1752},"indent":[]}}],"position":{"start":{"line":30,"column":65,"offset":1744},"end":{"line":30,"column":74,"offset":1753},"indent":[]}},{"type":"text","value":" them. We can easily do this by exporting them, using the anonymous function's ","position":{"start":{"line":30,"column":74,"offset":1753},"end":{"line":30,"column":153,"offset":1832},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"return value","position":{"start":{"line":30,"column":155,"offset":1834},"end":{"line":30,"column":167,"offset":1846},"indent":[]}}],"position":{"start":{"line":30,"column":153,"offset":1832},"end":{"line":30,"column":169,"offset":1848},"indent":[]}},{"type":"text","value":". Doing so will complete the basic module pattern, so here's a complete example:","position":{"start":{"line":30,"column":169,"offset":1848},"end":{"line":30,"column":249,"offset":1928},"indent":[]}}],"position":{"start":{"line":30,"column":1,"offset":1680},"end":{"line":30,"column":249,"offset":1928},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"let MODULE = (function () {\n    let my = {},\n        privateVariable = 1;\n\n    function privateMethod() {\n        // ...\n    }\n\n    my.moduleProperty = 1;\n    my.moduleMethod = function () {\n        // ...\n    };\n\n    return my;\n})();","position":{"start":{"line":32,"column":1,"offset":1930},"end":{"line":48,"column":4,"offset":2174},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Notice that we've declared a global module named ","position":{"start":{"line":50,"column":1,"offset":2176},"end":{"line":50,"column":50,"offset":2225},"indent":[]}},{"type":"inlineCode","value":"MODULE","position":{"start":{"line":50,"column":50,"offset":2225},"end":{"line":50,"column":58,"offset":2233},"indent":[]}},{"type":"text","value":", with two public properties: a method named ","position":{"start":{"line":50,"column":58,"offset":2233},"end":{"line":50,"column":103,"offset":2278},"indent":[]}},{"type":"inlineCode","value":"MODULE.moduleMethod","position":{"start":{"line":50,"column":103,"offset":2278},"end":{"line":50,"column":124,"offset":2299},"indent":[]}},{"type":"text","value":" and a variable named ","position":{"start":{"line":50,"column":124,"offset":2299},"end":{"line":50,"column":146,"offset":2321},"indent":[]}},{"type":"inlineCode","value":"MODULE.moduleProperty","position":{"start":{"line":50,"column":146,"offset":2321},"end":{"line":50,"column":169,"offset":2344},"indent":[]}},{"type":"text","value":". In addition, it maintains ","position":{"start":{"line":50,"column":169,"offset":2344},"end":{"line":50,"column":197,"offset":2372},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"private internal state","position":{"start":{"line":50,"column":199,"offset":2374},"end":{"line":50,"column":221,"offset":2396},"indent":[]}}],"position":{"start":{"line":50,"column":197,"offset":2372},"end":{"line":50,"column":223,"offset":2398},"indent":[]}},{"type":"text","value":" using the closure of the anonymous function. Also, we can easily import needed globals, using the pattern we learned above.","position":{"start":{"line":50,"column":223,"offset":2398},"end":{"line":50,"column":347,"offset":2522},"indent":[]}}],"position":{"start":{"line":50,"column":1,"offset":2176},"end":{"line":50,"column":347,"offset":2522},"indent":[]}},{"type":"heading","depth":6,"children":[{"type":"text","value":"## Advanced Patterns","position":{"start":{"line":52,"column":8,"offset":2531},"end":{"line":52,"column":28,"offset":2551},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":2524},"end":{"line":52,"column":28,"offset":2551},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"While the above is enough for many uses, we can take this pattern farther and create some very powerful, extensible constructs. Lets work through them one-by-one, continuing with our module named ","position":{"start":{"line":54,"column":1,"offset":2553},"end":{"line":54,"column":197,"offset":2749},"indent":[]}},{"type":"inlineCode","value":"MODULE","position":{"start":{"line":54,"column":197,"offset":2749},"end":{"line":54,"column":205,"offset":2757},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":54,"column":205,"offset":2757},"end":{"line":54,"column":206,"offset":2758},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":2553},"end":{"line":54,"column":206,"offset":2758},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Augmentation","position":{"start":{"line":56,"column":5,"offset":2764},"end":{"line":56,"column":17,"offset":2776},"indent":[]}}],"position":{"start":{"line":56,"column":1,"offset":2760},"end":{"line":56,"column":17,"offset":2776},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"One limitation of the module pattern so far is that the entire module must be in one file. Anyone who has worked in a large code-base understands the value of splitting among multiple files. Luckily, we have a nice solution to ","position":{"start":{"line":58,"column":1,"offset":2778},"end":{"line":58,"column":228,"offset":3005},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"augment modules","position":{"start":{"line":58,"column":230,"offset":3007},"end":{"line":58,"column":245,"offset":3022},"indent":[]}}],"position":{"start":{"line":58,"column":228,"offset":3005},"end":{"line":58,"column":247,"offset":3024},"indent":[]}},{"type":"text","value":". First, we import the module, then we add properties, then we export it. Here's an example, augmenting our ","position":{"start":{"line":58,"column":247,"offset":3024},"end":{"line":58,"column":355,"offset":3132},"indent":[]}},{"type":"inlineCode","value":"MODULE","position":{"start":{"line":58,"column":355,"offset":3132},"end":{"line":58,"column":363,"offset":3140},"indent":[]}},{"type":"text","value":" from above:","position":{"start":{"line":58,"column":363,"offset":3140},"end":{"line":58,"column":375,"offset":3152},"indent":[]}}],"position":{"start":{"line":58,"column":1,"offset":2778},"end":{"line":58,"column":375,"offset":3152},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"let MODULE = (function (my) {\n    my.anotherMethod = function () {\n        // added method...\n    };\n\n    return my;\n})(MODULE);","position":{"start":{"line":60,"column":1,"offset":3154},"end":{"line":68,"column":4,"offset":3292},"indent":[1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"We use the ","position":{"start":{"line":70,"column":1,"offset":3294},"end":{"line":70,"column":12,"offset":3305},"indent":[]}},{"type":"inlineCode","value":"var","position":{"start":{"line":70,"column":12,"offset":3305},"end":{"line":70,"column":17,"offset":3310},"indent":[]}},{"type":"text","value":" keyword again for consistency, even though it's not necessary. After this code has run, our module will have gained a new public method named ","position":{"start":{"line":70,"column":17,"offset":3310},"end":{"line":70,"column":160,"offset":3453},"indent":[]}},{"type":"inlineCode","value":"MODULE.anotherMethod","position":{"start":{"line":70,"column":160,"offset":3453},"end":{"line":70,"column":182,"offset":3475},"indent":[]}},{"type":"text","value":". This augmentation file will also maintain its own private internal state and imports.","position":{"start":{"line":70,"column":182,"offset":3475},"end":{"line":70,"column":269,"offset":3562},"indent":[]}}],"position":{"start":{"line":70,"column":1,"offset":3294},"end":{"line":70,"column":269,"offset":3562},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Loose Augmentation","position":{"start":{"line":72,"column":5,"offset":3568},"end":{"line":72,"column":23,"offset":3586},"indent":[]}}],"position":{"start":{"line":72,"column":1,"offset":3564},"end":{"line":72,"column":23,"offset":3586},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"While our example above requires our initial module creation to be first, and the augmentation to happen second, that isn't always necessary. One of the best things a JavaScript application can do for performance is to load scripts asynchronously. We can create flexible multi-part modules that can load themselves in any order with ","position":{"start":{"line":74,"column":1,"offset":3588},"end":{"line":74,"column":334,"offset":3921},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"loose augmentation","position":{"start":{"line":74,"column":336,"offset":3923},"end":{"line":74,"column":354,"offset":3941},"indent":[]}}],"position":{"start":{"line":74,"column":334,"offset":3921},"end":{"line":74,"column":356,"offset":3943},"indent":[]}},{"type":"text","value":". Each file should have the following structure:","position":{"start":{"line":74,"column":356,"offset":3943},"end":{"line":74,"column":404,"offset":3991},"indent":[]}}],"position":{"start":{"line":74,"column":1,"offset":3588},"end":{"line":74,"column":404,"offset":3991},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"let MODULE = (function (my) {\n// add capabilities...\n\n###### return my;\n}(MODULE || {}));","position":{"start":{"line":76,"column":1,"offset":3993},"end":{"line":82,"column":4,"offset":4090},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"In this pattern, the ","position":{"start":{"line":84,"column":1,"offset":4092},"end":{"line":84,"column":22,"offset":4113},"indent":[]}},{"type":"inlineCode","value":"var","position":{"start":{"line":84,"column":22,"offset":4113},"end":{"line":84,"column":27,"offset":4118},"indent":[]}},{"type":"text","value":" statement is always necessary. Note that the import will create the module if it does not already exist. This means you can use a tool like ","position":{"start":{"line":84,"column":27,"offset":4118},"end":{"line":84,"column":168,"offset":4259},"indent":[]}},{"type":"link","title":null,"url":"http://labjs.com/","children":[{"type":"text","value":"LABjs","position":{"start":{"line":84,"column":169,"offset":4260},"end":{"line":84,"column":174,"offset":4265},"indent":[]}}],"position":{"start":{"line":84,"column":168,"offset":4259},"end":{"line":84,"column":194,"offset":4285},"indent":[]}},{"type":"text","value":" and load all of your module files in parallel, without needing to block.","position":{"start":{"line":84,"column":194,"offset":4285},"end":{"line":84,"column":267,"offset":4358},"indent":[]}}],"position":{"start":{"line":84,"column":1,"offset":4092},"end":{"line":84,"column":267,"offset":4358},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Tight Augmentation","position":{"start":{"line":86,"column":5,"offset":4364},"end":{"line":86,"column":23,"offset":4382},"indent":[]}}],"position":{"start":{"line":86,"column":1,"offset":4360},"end":{"line":86,"column":23,"offset":4382},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"While loose augmentation is great, it does place some limitations on your module. Most importantly, you cannot override module properties safely. You also cannot use module properties from other files during initialization (but you can at run-time after intialization). ","position":{"start":{"line":88,"column":1,"offset":4384},"end":{"line":88,"column":271,"offset":4654},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"Tight augmentation","position":{"start":{"line":88,"column":273,"offset":4656},"end":{"line":88,"column":291,"offset":4674},"indent":[]}}],"position":{"start":{"line":88,"column":271,"offset":4654},"end":{"line":88,"column":293,"offset":4676},"indent":[]}},{"type":"text","value":" implies a set loading order, but allows ","position":{"start":{"line":88,"column":293,"offset":4676},"end":{"line":88,"column":334,"offset":4717},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"overrides","position":{"start":{"line":88,"column":336,"offset":4719},"end":{"line":88,"column":345,"offset":4728},"indent":[]}}],"position":{"start":{"line":88,"column":334,"offset":4717},"end":{"line":88,"column":347,"offset":4730},"indent":[]}},{"type":"text","value":". Here is a simple example (augmenting our original ","position":{"start":{"line":88,"column":347,"offset":4730},"end":{"line":88,"column":399,"offset":4782},"indent":[]}},{"type":"inlineCode","value":"MODULE","position":{"start":{"line":88,"column":399,"offset":4782},"end":{"line":88,"column":407,"offset":4790},"indent":[]}},{"type":"text","value":"):","position":{"start":{"line":88,"column":407,"offset":4790},"end":{"line":88,"column":409,"offset":4792},"indent":[]}}],"position":{"start":{"line":88,"column":1,"offset":4384},"end":{"line":88,"column":409,"offset":4792},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"let MODULE = (function (my) {\n    let old_moduleMethod = my.moduleMethod;\n\n    my.moduleMethod = function () {\n        // method override, has access to old through old_moduleMethod...\n    };\n\n    return my;\n})(MODULE);","position":{"start":{"line":90,"column":1,"offset":4794},"end":{"line":100,"column":4,"offset":5023},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Here we've overridden ","position":{"start":{"line":102,"column":1,"offset":5025},"end":{"line":102,"column":23,"offset":5047},"indent":[]}},{"type":"inlineCode","value":"MODULE.moduleMethod","position":{"start":{"line":102,"column":23,"offset":5047},"end":{"line":102,"column":44,"offset":5068},"indent":[]}},{"type":"text","value":", but maintain a reference to the original method, if needed.","position":{"start":{"line":102,"column":44,"offset":5068},"end":{"line":102,"column":105,"offset":5129},"indent":[]}}],"position":{"start":{"line":102,"column":1,"offset":5025},"end":{"line":102,"column":105,"offset":5129},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Cloning and Inheritance","position":{"start":{"line":104,"column":5,"offset":5135},"end":{"line":104,"column":28,"offset":5158},"indent":[]}}],"position":{"start":{"line":104,"column":1,"offset":5131},"end":{"line":104,"column":28,"offset":5158},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"let MODULE_TWO = (function (old) {\n    let my = {},\n        key;\n\n    for (key in old) {\n        if (old.hasOwnProperty(key)) {\n            my[key] = old[key];\n        }\n    }\n\n    let super_moduleMethod = old.moduleMethod;\n    my.moduleMethod = function () {\n        // override method on the clone, access to super through super_moduleMethod\n    };\n\n    return my;\n})(MODULE);","position":{"start":{"line":106,"column":1,"offset":5160},"end":{"line":124,"column":4,"offset":5548},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"This pattern is perhaps the ","position":{"start":{"line":126,"column":1,"offset":5550},"end":{"line":126,"column":29,"offset":5578},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"least flexible","position":{"start":{"line":126,"column":31,"offset":5580},"end":{"line":126,"column":45,"offset":5594},"indent":[]}}],"position":{"start":{"line":126,"column":29,"offset":5578},"end":{"line":126,"column":47,"offset":5596},"indent":[]}},{"type":"text","value":" option. It does allow some neat compositions, but that comes at the expense of flexibility. As I've written it, properties which are objects or functions will ","position":{"start":{"line":126,"column":47,"offset":5596},"end":{"line":126,"column":207,"offset":5756},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"not","position":{"start":{"line":126,"column":208,"offset":5757},"end":{"line":126,"column":211,"offset":5760},"indent":[]}}],"position":{"start":{"line":126,"column":207,"offset":5756},"end":{"line":126,"column":212,"offset":5761},"indent":[]}},{"type":"text","value":" be duplicated, they will exist as one object with two references. Changing one will change the other. This could be fixed for objects with a recursive cloning process, but probably cannot be fixed for functions, except perhaps with ","position":{"start":{"line":126,"column":212,"offset":5761},"end":{"line":126,"column":445,"offset":5994},"indent":[]}},{"type":"inlineCode","value":"eval","position":{"start":{"line":126,"column":445,"offset":5994},"end":{"line":126,"column":451,"offset":6000},"indent":[]}},{"type":"text","value":". Nevertheless, I've included it for completeness.","position":{"start":{"line":126,"column":451,"offset":6000},"end":{"line":126,"column":501,"offset":6050},"indent":[]}}],"position":{"start":{"line":126,"column":1,"offset":5550},"end":{"line":126,"column":501,"offset":6050},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Cross-File Private State","position":{"start":{"line":128,"column":5,"offset":6056},"end":{"line":128,"column":29,"offset":6080},"indent":[]}}],"position":{"start":{"line":128,"column":1,"offset":6052},"end":{"line":128,"column":29,"offset":6080},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"One severe limitation of splitting a module across multiple files is that each file maintains its own private state, and does not get access to the private state of the other files. This can be fixed. Here is an example of a loosely augmented module that will ","position":{"start":{"line":130,"column":1,"offset":6082},"end":{"line":130,"column":261,"offset":6342},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"maintain private state","position":{"start":{"line":130,"column":263,"offset":6344},"end":{"line":130,"column":285,"offset":6366},"indent":[]}}],"position":{"start":{"line":130,"column":261,"offset":6342},"end":{"line":130,"column":287,"offset":6368},"indent":[]}},{"type":"text","value":" across all augmentations:","position":{"start":{"line":130,"column":287,"offset":6368},"end":{"line":130,"column":313,"offset":6394},"indent":[]}}],"position":{"start":{"line":130,"column":1,"offset":6082},"end":{"line":130,"column":313,"offset":6394},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"let MODULE = (function (my) {\n    let _private = (my._private = my._private || {}),\n        _seal = (my._seal =\n            my._seal ||\n            function () {\n                delete my._private;\n                delete my._seal;\n                delete my._unseal;\n            }),\n        _unseal = (my._unseal =\n            my._unseal ||\n            function () {\n                my._private = _private;\n                my._seal = _seal;\n                my._unseal = _unseal;\n            });\n\n    // permanent access to _private, _seal, and _unseal\n\n    return my;\n})(MODULE || {});","position":{"start":{"line":132,"column":1,"offset":6396},"end":{"line":154,"column":4,"offset":6990},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Any file can set properties on their local variable ","position":{"start":{"line":156,"column":1,"offset":6992},"end":{"line":156,"column":53,"offset":7044},"indent":[]}},{"type":"inlineCode","value":"_private","position":{"start":{"line":156,"column":53,"offset":7044},"end":{"line":156,"column":63,"offset":7054},"indent":[]}},{"type":"text","value":", and it will be immediately available to the others. Once this module has loaded completely, the application should call ","position":{"start":{"line":156,"column":63,"offset":7054},"end":{"line":156,"column":185,"offset":7176},"indent":[]}},{"type":"inlineCode","value":"MODULE._seal()","position":{"start":{"line":156,"column":185,"offset":7176},"end":{"line":156,"column":201,"offset":7192},"indent":[]}},{"type":"text","value":", which will prevent external access to the internal ","position":{"start":{"line":156,"column":201,"offset":7192},"end":{"line":156,"column":254,"offset":7245},"indent":[]}},{"type":"inlineCode","value":"_private","position":{"start":{"line":156,"column":254,"offset":7245},"end":{"line":156,"column":264,"offset":7255},"indent":[]}},{"type":"text","value":". If this module were to be augmented again, further in the application's lifetime, one of the internal methods, in any file, can call ","position":{"start":{"line":156,"column":264,"offset":7255},"end":{"line":156,"column":399,"offset":7390},"indent":[]}},{"type":"inlineCode","value":"_unseal()","position":{"start":{"line":156,"column":399,"offset":7390},"end":{"line":156,"column":410,"offset":7401},"indent":[]}},{"type":"text","value":" before loading the new file, and call ","position":{"start":{"line":156,"column":410,"offset":7401},"end":{"line":156,"column":449,"offset":7440},"indent":[]}},{"type":"inlineCode","value":"_seal()","position":{"start":{"line":156,"column":449,"offset":7440},"end":{"line":156,"column":458,"offset":7449},"indent":[]}},{"type":"text","value":" again after it has been executed. This pattern occurred to me today while I was at work, I have not seen this elsewhere. I think this is a very useful pattern, and would have been worth writing about all on its own.","position":{"start":{"line":156,"column":458,"offset":7449},"end":{"line":156,"column":674,"offset":7665},"indent":[]}}],"position":{"start":{"line":156,"column":1,"offset":6992},"end":{"line":156,"column":674,"offset":7665},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Sub-modules","position":{"start":{"line":158,"column":5,"offset":7671},"end":{"line":158,"column":16,"offset":7682},"indent":[]}}],"position":{"start":{"line":158,"column":1,"offset":7667},"end":{"line":158,"column":16,"offset":7682},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Our final advanced pattern is actually the simplest. There are many good cases for creating sub-modules. It is just like creating regular modules:","position":{"start":{"line":160,"column":1,"offset":7684},"end":{"line":160,"column":147,"offset":7830},"indent":[]}}],"position":{"start":{"line":160,"column":1,"offset":7684},"end":{"line":160,"column":147,"offset":7830},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"MODULE.sub = (function () {\n    let my = {};\n    // ...\n\n######   return my;\n})();","position":{"start":{"line":162,"column":1,"offset":7832},"end":{"line":169,"column":4,"offset":7924},"indent":[1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"While this may have been obvious, I thought it worth including. Sub-modules have all the advanced capabilities of normal modules, including augmentation and private state.","position":{"start":{"line":171,"column":1,"offset":7926},"end":{"line":171,"column":172,"offset":8097},"indent":[]}}],"position":{"start":{"line":171,"column":1,"offset":7926},"end":{"line":171,"column":172,"offset":8097},"indent":[]}},{"type":"heading","depth":6,"children":[{"type":"text","value":"## Conclusions","position":{"start":{"line":173,"column":8,"offset":8106},"end":{"line":173,"column":22,"offset":8120},"indent":[]}}],"position":{"start":{"line":173,"column":1,"offset":8099},"end":{"line":173,"column":22,"offset":8120},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Most of the advanced patterns can be combined with each other to create more useful patterns. If I had to advocate a route to take in designing a complex application, I'd combine ","position":{"start":{"line":175,"column":1,"offset":8122},"end":{"line":175,"column":180,"offset":8301},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"loose augmentation","position":{"start":{"line":175,"column":182,"offset":8303},"end":{"line":175,"column":200,"offset":8321},"indent":[]}}],"position":{"start":{"line":175,"column":180,"offset":8301},"end":{"line":175,"column":202,"offset":8323},"indent":[]}},{"type":"text","value":", ","position":{"start":{"line":175,"column":202,"offset":8323},"end":{"line":175,"column":204,"offset":8325},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"private state","position":{"start":{"line":175,"column":206,"offset":8327},"end":{"line":175,"column":219,"offset":8340},"indent":[]}}],"position":{"start":{"line":175,"column":204,"offset":8325},"end":{"line":175,"column":221,"offset":8342},"indent":[]}},{"type":"text","value":", and ","position":{"start":{"line":175,"column":221,"offset":8342},"end":{"line":175,"column":227,"offset":8348},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"sub-modules","position":{"start":{"line":175,"column":229,"offset":8350},"end":{"line":175,"column":240,"offset":8361},"indent":[]}}],"position":{"start":{"line":175,"column":227,"offset":8348},"end":{"line":175,"column":242,"offset":8363},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":175,"column":242,"offset":8363},"end":{"line":175,"column":243,"offset":8364},"indent":[]}}],"position":{"start":{"line":175,"column":1,"offset":8122},"end":{"line":175,"column":243,"offset":8364},"indent":[]}},{"type":"heading","depth":6,"children":[{"type":"text","value":"I haven't touched on performance here at all, but I'd like to put in one quick note: The module pattern is ","position":{"start":{"line":177,"column":8,"offset":8373},"end":{"line":177,"column":115,"offset":8480},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"good for performance","position":{"start":{"line":177,"column":117,"offset":8482},"end":{"line":177,"column":137,"offset":8502},"indent":[]}}],"position":{"start":{"line":177,"column":115,"offset":8480},"end":{"line":177,"column":139,"offset":8504},"indent":[]}},{"type":"text","value":". It minifies really well, which makes downloading the code faster. Using ","position":{"start":{"line":177,"column":139,"offset":8504},"end":{"line":177,"column":213,"offset":8578},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"loose augmentation","position":{"start":{"line":177,"column":215,"offset":8580},"end":{"line":177,"column":233,"offset":8598},"indent":[]}}],"position":{"start":{"line":177,"column":213,"offset":8578},"end":{"line":177,"column":235,"offset":8600},"indent":[]}},{"type":"text","value":" allows easy non-blocking parallel downloads, which also speeds up download speeds. Initialization time is probably a bit slower than other methods, but worth the trade-off. Run-time performance should suffer no penalties so long as globals are imported correctly, and will probably gain speed in sub-modules by shortening the reference chain with local variables.","position":{"start":{"line":177,"column":235,"offset":8600},"end":{"line":177,"column":599,"offset":8964},"indent":[]}}],"position":{"start":{"line":177,"column":1,"offset":8366},"end":{"line":177,"column":599,"offset":8964},"indent":[]}},{"type":"heading","depth":6,"children":[{"type":"text","value":"To close, here's an example of a sub-module that loads itself dynamically to its parent (creating it if it does not exist). I've left out private state for brevity, but including it would be simple. This code pattern allows an entire complex heirarchical code-base to be loaded completely in parallel with itself, sub-modules and all.","position":{"start":{"line":179,"column":8,"offset":8973},"end":{"line":179,"column":342,"offset":9307},"indent":[]}}],"position":{"start":{"line":179,"column":1,"offset":8966},"end":{"line":179,"column":342,"offset":9307},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"let UTIL = (function (parent, $) {\n    let my = (parent.ajax = parent.ajax || {});\n\n    my.get = function (url, params, callback) {\n        // ok, so I'm cheating a bit :)\n        return $.getJSON(url, params, callback);\n    };\n\n    // etc...\n\n######   return parent;\n})(UTIL || {}, jQuery);","position":{"start":{"line":181,"column":1,"offset":9309},"end":{"line":194,"column":4,"offset":9610},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"Summary:","position":{"start":{"line":196,"column":3,"offset":9614},"end":{"line":196,"column":11,"offset":9622},"indent":[]}}],"position":{"start":{"line":196,"column":1,"offset":9612},"end":{"line":196,"column":11,"offset":9622},"indent":[]}},{"type":"html","value":"<details>","position":{"start":{"line":198,"column":1,"offset":9624},"end":{"line":198,"column":10,"offset":9633},"indent":[]}},{"type":"html","value":"<summary> recitation  </summary>","position":{"start":{"line":200,"column":1,"offset":9635},"end":{"line":200,"column":33,"offset":9667},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Anonymous Closures","position":{"start":{"line":202,"column":5,"offset":9673},"end":{"line":202,"column":23,"offset":9691},"indent":[]}}],"position":{"start":{"line":202,"column":1,"offset":9669},"end":{"line":202,"column":23,"offset":9691},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"(function () {\n    // ... all vars and functions are in this scope only\n    // still maintains access to all globals\n})();","position":{"start":{"line":204,"column":1,"offset":9693},"end":{"line":209,"column":4,"offset":9825},"indent":[1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Global Import","position":{"start":{"line":211,"column":5,"offset":9831},"end":{"line":211,"column":18,"offset":9844},"indent":[]}}],"position":{"start":{"line":211,"column":1,"offset":9827},"end":{"line":211,"column":18,"offset":9844},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"(function ($, YAHOO) {\n    // now have access to globals jQuery (as $) and YAHOO in this code\n})(jQuery, YAHOO);","position":{"start":{"line":213,"column":1,"offset":9846},"end":{"line":217,"column":4,"offset":9968},"indent":[1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Module Export","position":{"start":{"line":219,"column":5,"offset":9974},"end":{"line":219,"column":18,"offset":9987},"indent":[]}}],"position":{"start":{"line":219,"column":1,"offset":9970},"end":{"line":219,"column":18,"offset":9987},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"let MODULE = (function () {\n    let my = {},\n        privateVariable = 1;\n\n    function privateMethod() {\n        // ...\n    }\n\n    my.moduleProperty = 1;\n    my.moduleMethod = function () {\n        // ...\n    };\n\n    return my;\n})();","position":{"start":{"line":221,"column":1,"offset":9989},"end":{"line":237,"column":4,"offset":10233},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"Advanced Patterns","position":{"start":{"line":239,"column":3,"offset":10237},"end":{"line":239,"column":20,"offset":10254},"indent":[]}}],"position":{"start":{"line":239,"column":1,"offset":10235},"end":{"line":239,"column":20,"offset":10254},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Augmentation","position":{"start":{"line":241,"column":5,"offset":10260},"end":{"line":241,"column":17,"offset":10272},"indent":[]}}],"position":{"start":{"line":241,"column":1,"offset":10256},"end":{"line":241,"column":17,"offset":10272},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"let MODULE = (function (my) {\n    my.anotherMethod = function () {\n        // added method...\n    };\n\n    return my;\n})(MODULE);","position":{"start":{"line":243,"column":1,"offset":10274},"end":{"line":251,"column":4,"offset":10412},"indent":[1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Loose Augmentation","position":{"start":{"line":253,"column":5,"offset":10418},"end":{"line":253,"column":23,"offset":10436},"indent":[]}}],"position":{"start":{"line":253,"column":1,"offset":10414},"end":{"line":253,"column":23,"offset":10436},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In this pattern, the let statement is always necessary. Note that the import will create the module if it does not already exist. This means you can use a tool like LABjs and load all of your module files in parallel, without needing to block.","position":{"start":{"line":255,"column":1,"offset":10438},"end":{"line":255,"column":244,"offset":10681},"indent":[]}}],"position":{"start":{"line":255,"column":1,"offset":10438},"end":{"line":255,"column":244,"offset":10681},"indent":[]}},{"type":"heading","depth":6,"children":[{"type":"text","value":"`","position":{"start":{"line":257,"column":8,"offset":10690},"end":{"line":257,"column":9,"offset":10691},"indent":[]}},{"type":"inlineCode","value":"","position":{"start":{"line":257,"column":9,"offset":10691},"end":{"line":257,"column":11,"offset":10693},"indent":[]}},{"type":"text","value":"js","position":{"start":{"line":257,"column":11,"offset":10693},"end":{"line":257,"column":13,"offset":10695},"indent":[]}}],"position":{"start":{"line":257,"column":1,"offset":10683},"end":{"line":257,"column":13,"offset":10695},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"let MODULE = (function (my) {\n// add capabilities...","position":{"start":{"line":259,"column":1,"offset":10697},"end":{"line":260,"column":23,"offset":10749},"indent":[1]}}],"position":{"start":{"line":259,"column":1,"offset":10697},"end":{"line":260,"column":23,"offset":10749},"indent":[1]}},{"type":"heading","depth":6,"children":[{"type":"text","value":"return my;","position":{"start":{"line":262,"column":8,"offset":10758},"end":{"line":262,"column":18,"offset":10768},"indent":[]}}],"position":{"start":{"line":262,"column":1,"offset":10751},"end":{"line":262,"column":18,"offset":10768},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"})(MODULE || {});","position":{"start":{"line":264,"column":1,"offset":10770},"end":{"line":264,"column":18,"offset":10787},"indent":[]}}],"position":{"start":{"line":264,"column":1,"offset":10770},"end":{"line":264,"column":18,"offset":10787},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"### Tight Augmentation\n\nHere we've overridden MODULE.moduleMethod, but maintain a reference to the original method, if needed.\n\n###### ```js\nlet MODULE = (function (my) {\n    let old_moduleMethod = my.moduleMethod;\n\n    my.moduleMethod = function () {\n        // method override, has access to old through old_moduleMethod...\n    };\n\n    return my;\n})(MODULE);","position":{"start":{"line":266,"column":1,"offset":10789},"end":{"line":282,"column":4,"offset":11158},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Cloning and Inheritance","position":{"start":{"line":284,"column":5,"offset":11164},"end":{"line":284,"column":28,"offset":11187},"indent":[]}}],"position":{"start":{"line":284,"column":1,"offset":11160},"end":{"line":284,"column":28,"offset":11187},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"let MODULE_TWO = (function (old) {\n    let my = {},\n        key;\n\n    for (key in old) {\n        if (old.hasOwnProperty(key)) {\n            my[key] = old[key];\n        }\n    }\n\n    let super_moduleMethod = old.moduleMethod;\n    my.moduleMethod = function () {\n        // override method on the clone, access to super through super_moduleMethod\n    };\n\n    return my;\n})(MODULE);","position":{"start":{"line":286,"column":1,"offset":11189},"end":{"line":304,"column":4,"offset":11577},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Cross-File Private State","position":{"start":{"line":306,"column":5,"offset":11583},"end":{"line":306,"column":29,"offset":11607},"indent":[]}}],"position":{"start":{"line":306,"column":1,"offset":11579},"end":{"line":306,"column":29,"offset":11607},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"let MODULE = (function (my) {\n    let _private = (my._private = my._private || {}),\n        _seal = (my._seal =\n            my._seal ||\n            function () {\n                delete my._private;\n                delete my._seal;\n                delete my._unseal;\n            }),\n        _unseal = (my._unseal =\n            my._unseal ||\n            function () {\n                my._private = _private;\n                my._seal = _seal;\n                my._unseal = _unseal;\n            });\n\n    // permanent access to _private, _seal, and _unseal\n\n    return my;\n})(MODULE || {});","position":{"start":{"line":308,"column":1,"offset":11609},"end":{"line":330,"column":4,"offset":12203},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Sub-modules","position":{"start":{"line":332,"column":5,"offset":12209},"end":{"line":332,"column":16,"offset":12220},"indent":[]}}],"position":{"start":{"line":332,"column":1,"offset":12205},"end":{"line":332,"column":16,"offset":12220},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"MODULE.sub = (function () {\n    let my = {};\n    // ...\n\n######   return my;\n})();","position":{"start":{"line":334,"column":1,"offset":12222},"end":{"line":341,"column":4,"offset":12314},"indent":[1,1,1,1,1,1,1]}},{"type":"html","value":"</details>","position":{"start":{"line":343,"column":1,"offset":12316},"end":{"line":343,"column":11,"offset":12326},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":344,"column":1,"offset":12327}}}}