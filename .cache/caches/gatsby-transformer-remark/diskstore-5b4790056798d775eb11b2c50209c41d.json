{"expireTime":9007200904306550000,"key":"transformer-remark-markdown-html-ast-b9715b9228852f19b975055eb51d7d5e--","val":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Async functions:","position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":19,"offset":19}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":19,"offset":19}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Asynchronous JavaScript","position":{"start":{"line":3,"column":4,"offset":23},"end":{"line":3,"column":27,"offset":46}}}],"position":{"start":{"line":3,"column":1,"offset":20},"end":{"line":3,"column":27,"offset":46}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's start with the ","position":{"start":{"line":5,"column":1,"offset":48},"end":{"line":5,"column":22,"offset":69}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":5,"column":22,"offset":69},"end":{"line":5,"column":29,"offset":76}}},{"type":"text","value":" keyword. It can be placed before a function, like this:","position":{"start":{"line":5,"column":29,"offset":76},"end":{"line":5,"column":85,"offset":132}}}],"position":{"start":{"line":5,"column":1,"offset":48},"end":{"line":5,"column":85,"offset":132}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    return 1;\n}\n"}],"position":{"start":{"line":7,"column":1,"offset":134},"end":{"line":11,"column":4,"offset":180}}}],"position":{"start":{"line":7,"column":1,"offset":134},"end":{"line":11,"column":4,"offset":180}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The word \"async\" before a function means one simple thing: a function always returns a promise. Other values are wrapped in a resolved promise automatically.","position":{"start":{"line":13,"column":1,"offset":182},"end":{"line":13,"column":158,"offset":339}}}],"position":{"start":{"line":13,"column":1,"offset":182},"end":{"line":13,"column":158,"offset":339}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For instance, this function returns a resolved promise with the result of ","position":{"start":{"line":15,"column":1,"offset":341},"end":{"line":15,"column":75,"offset":415}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"1"}],"position":{"start":{"line":15,"column":75,"offset":415},"end":{"line":15,"column":78,"offset":418}}},{"type":"text","value":"; let's test it:","position":{"start":{"line":15,"column":78,"offset":418},"end":{"line":15,"column":94,"offset":434}}}],"position":{"start":{"line":15,"column":1,"offset":341},"end":{"line":15,"column":94,"offset":434}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    return 1;\n}\n\nf().then(alert); // 1\n"}],"position":{"start":{"line":17,"column":1,"offset":436},"end":{"line":23,"column":4,"offset":505}}}],"position":{"start":{"line":17,"column":1,"offset":436},"end":{"line":23,"column":4,"offset":505}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"...We could explicitly return a promise, which would be the same:","position":{"start":{"line":25,"column":1,"offset":507},"end":{"line":25,"column":66,"offset":572}}}],"position":{"start":{"line":25,"column":1,"offset":507},"end":{"line":25,"column":66,"offset":572}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    return Promise.resolve(1);\n}\n\nf().then(alert); // 1\n"}],"position":{"start":{"line":27,"column":1,"offset":574},"end":{"line":33,"column":4,"offset":660}}}],"position":{"start":{"line":27,"column":1,"offset":574},"end":{"line":33,"column":4,"offset":660}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So, ","position":{"start":{"line":35,"column":1,"offset":662},"end":{"line":35,"column":5,"offset":666}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":35,"column":5,"offset":666},"end":{"line":35,"column":12,"offset":673}}},{"type":"text","value":" ensures that the function returns a promise, and wraps non-promises in it. Simple enough, right? But not only that. There's another keyword, ","position":{"start":{"line":35,"column":12,"offset":673},"end":{"line":35,"column":154,"offset":815}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":35,"column":154,"offset":815},"end":{"line":35,"column":161,"offset":822}}},{"type":"text","value":", that works only inside ","position":{"start":{"line":35,"column":161,"offset":822},"end":{"line":35,"column":186,"offset":847}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":35,"column":186,"offset":847},"end":{"line":35,"column":193,"offset":854}}},{"type":"text","value":" functions, and it's pretty cool.","position":{"start":{"line":35,"column":193,"offset":854},"end":{"line":35,"column":226,"offset":887}}}],"position":{"start":{"line":35,"column":1,"offset":662},"end":{"line":35,"column":226,"offset":887}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#await"},"children":[{"type":"text","value":"Await","position":{"start":{"line":37,"column":5,"offset":893},"end":{"line":37,"column":10,"offset":898}}}],"position":{"start":{"line":37,"column":4,"offset":892},"end":{"line":37,"column":19,"offset":907}}}],"position":{"start":{"line":37,"column":1,"offset":889},"end":{"line":37,"column":19,"offset":907}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The syntax:","position":{"start":{"line":39,"column":1,"offset":909},"end":{"line":39,"column":12,"offset":920}}}],"position":{"start":{"line":39,"column":1,"offset":909},"end":{"line":39,"column":12,"offset":920}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"// works only inside async functions\nlet value = await promise;\n"}],"position":{"start":{"line":41,"column":1,"offset":922},"end":{"line":44,"column":4,"offset":995}}}],"position":{"start":{"line":41,"column":1,"offset":922},"end":{"line":44,"column":4,"offset":995}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The keyword ","position":{"start":{"line":46,"column":1,"offset":997},"end":{"line":46,"column":13,"offset":1009}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":46,"column":13,"offset":1009},"end":{"line":46,"column":20,"offset":1016}}},{"type":"text","value":" makes JavaScript wait until that promise settles and returns its result.","position":{"start":{"line":46,"column":20,"offset":1016},"end":{"line":46,"column":93,"offset":1089}}}],"position":{"start":{"line":46,"column":1,"offset":997},"end":{"line":46,"column":93,"offset":1089}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Here's an example with a promise that resolves in 1 second:","position":{"start":{"line":48,"column":1,"offset":1091},"end":{"line":48,"column":60,"offset":1150}}}],"position":{"start":{"line":48,"column":1,"offset":1091},"end":{"line":48,"column":60,"offset":1150}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    let promise = new Promise((resolve, reject) => {\n        setTimeout(() => resolve('done!'), 1000);\n    });\n\n    let result = await promise; // wait until the promise resolves (*)\n\n    alert(result); // \"done!\"\n}\n\nf();\n"}],"position":{"start":{"line":50,"column":1,"offset":1152},"end":{"line":62,"column":4,"offset":1404}}}],"position":{"start":{"line":50,"column":1,"offset":1152},"end":{"line":62,"column":4,"offset":1404}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The function execution \"pauses\" at the line ","position":{"start":{"line":64,"column":1,"offset":1406},"end":{"line":64,"column":45,"offset":1450}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"(*)"}],"position":{"start":{"line":64,"column":45,"offset":1450},"end":{"line":64,"column":50,"offset":1455}}},{"type":"text","value":" and resumes when the promise settles, with ","position":{"start":{"line":64,"column":50,"offset":1455},"end":{"line":64,"column":94,"offset":1499}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"result"}],"position":{"start":{"line":64,"column":94,"offset":1499},"end":{"line":64,"column":102,"offset":1507}}},{"type":"text","value":" becoming its result. So the code above shows \"done!\" in one second.","position":{"start":{"line":64,"column":102,"offset":1507},"end":{"line":64,"column":170,"offset":1575}}}],"position":{"start":{"line":64,"column":1,"offset":1406},"end":{"line":64,"column":170,"offset":1575}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's emphasize: ","position":{"start":{"line":66,"column":1,"offset":1577},"end":{"line":66,"column":18,"offset":1594}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":66,"column":18,"offset":1594},"end":{"line":66,"column":25,"offset":1601}}},{"type":"text","value":" literally suspends the function execution until the promise settles, and then resumes it with the promise result. That doesn't cost any CPU resources, because the JavaScript engine can do other jobs in the meantime: execute other scripts, handle events, etc.","position":{"start":{"line":66,"column":25,"offset":1601},"end":{"line":66,"column":284,"offset":1860}}}],"position":{"start":{"line":66,"column":1,"offset":1577},"end":{"line":66,"column":284,"offset":1860}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It's just a more elegant syntax of getting the promise result than ","position":{"start":{"line":68,"column":1,"offset":1862},"end":{"line":68,"column":68,"offset":1929}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"promise.then"}],"position":{"start":{"line":68,"column":68,"offset":1929},"end":{"line":68,"column":82,"offset":1943}}},{"type":"text","value":". And, it's easier to read and write.","position":{"start":{"line":68,"column":82,"offset":1943},"end":{"line":68,"column":119,"offset":1980}}}],"position":{"start":{"line":68,"column":1,"offset":1862},"end":{"line":68,"column":119,"offset":1980}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Can't use ","position":{"start":{"line":70,"column":1,"offset":1982},"end":{"line":70,"column":11,"offset":1992}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":70,"column":11,"offset":1992},"end":{"line":70,"column":18,"offset":1999}}},{"type":"text","value":" in regular functions","position":{"start":{"line":70,"column":18,"offset":1999},"end":{"line":70,"column":39,"offset":2020}}}],"position":{"start":{"line":70,"column":1,"offset":1982},"end":{"line":70,"column":39,"offset":2020}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we try to use ","position":{"start":{"line":72,"column":1,"offset":2022},"end":{"line":72,"column":18,"offset":2039}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":72,"column":18,"offset":2039},"end":{"line":72,"column":25,"offset":2046}}},{"type":"text","value":" in a non-async function, there would be a syntax error:","position":{"start":{"line":72,"column":25,"offset":2046},"end":{"line":72,"column":81,"offset":2102}}}],"position":{"start":{"line":72,"column":1,"offset":2022},"end":{"line":72,"column":81,"offset":2102}}},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[],"position":{"start":{"line":74,"column":1,"offset":2104},"end":{"line":74,"column":4,"offset":2107}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"function f() {\n    let promise = Promise.resolve(1);\n    let result = await promise; // Syntax error\n}\n"}],"position":{"start":{"line":77,"column":1,"offset":2110},"end":{"line":84,"column":4,"offset":2224}}}],"position":{"start":{"line":77,"column":1,"offset":2110},"end":{"line":84,"column":4,"offset":2224}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We may get this error if we forget to put ","position":{"start":{"line":86,"column":1,"offset":2226},"end":{"line":86,"column":43,"offset":2268}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":86,"column":43,"offset":2268},"end":{"line":86,"column":50,"offset":2275}}},{"type":"text","value":" before a function. As stated earlier, ","position":{"start":{"line":86,"column":50,"offset":2275},"end":{"line":86,"column":89,"offset":2314}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":86,"column":89,"offset":2314},"end":{"line":86,"column":96,"offset":2321}}},{"type":"text","value":" only works inside an ","position":{"start":{"line":86,"column":96,"offset":2321},"end":{"line":86,"column":118,"offset":2343}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":86,"column":118,"offset":2343},"end":{"line":86,"column":125,"offset":2350}}},{"type":"text","value":" function.","position":{"start":{"line":86,"column":125,"offset":2350},"end":{"line":86,"column":135,"offset":2360}}}],"position":{"start":{"line":86,"column":1,"offset":2226},"end":{"line":86,"column":135,"offset":2360}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's take the ","position":{"start":{"line":88,"column":1,"offset":2362},"end":{"line":88,"column":16,"offset":2377}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"showAvatar()"}],"position":{"start":{"line":88,"column":16,"offset":2377},"end":{"line":88,"column":30,"offset":2391}}},{"type":"text","value":" example from the chapter ","position":{"start":{"line":88,"column":30,"offset":2391},"end":{"line":88,"column":56,"offset":2417}}},{"type":"element","tagName":"a","properties":{"href":"promise-chaining"},"children":[{"type":"text","value":"Promises chaining","position":{"start":{"line":88,"column":57,"offset":2418},"end":{"line":88,"column":74,"offset":2435}}}],"position":{"start":{"line":88,"column":56,"offset":2417},"end":{"line":88,"column":93,"offset":2454}}},{"type":"text","value":" and rewrite it using ","position":{"start":{"line":88,"column":93,"offset":2454},"end":{"line":88,"column":115,"offset":2476}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async/await"}],"position":{"start":{"line":88,"column":115,"offset":2476},"end":{"line":88,"column":128,"offset":2489}}},{"type":"text","value":":","position":{"start":{"line":88,"column":128,"offset":2489},"end":{"line":88,"column":129,"offset":2490}}}],"position":{"start":{"line":88,"column":1,"offset":2362},"end":{"line":88,"column":129,"offset":2490}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"We'll need to replace ","position":{"start":{"line":90,"column":5,"offset":2496},"end":{"line":90,"column":27,"offset":2518}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".then"}],"position":{"start":{"line":90,"column":27,"offset":2518},"end":{"line":90,"column":34,"offset":2525}}},{"type":"text","value":" calls with ","position":{"start":{"line":90,"column":34,"offset":2525},"end":{"line":90,"column":46,"offset":2537}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":90,"column":46,"offset":2537},"end":{"line":90,"column":53,"offset":2544}}},{"type":"text","value":".","position":{"start":{"line":90,"column":53,"offset":2544},"end":{"line":90,"column":54,"offset":2545}}}],"position":{"start":{"line":90,"column":1,"offset":2492},"end":{"line":90,"column":54,"offset":2545}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Also we should make the function ","position":{"start":{"line":91,"column":5,"offset":2550},"end":{"line":91,"column":38,"offset":2583}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":91,"column":38,"offset":2583},"end":{"line":91,"column":45,"offset":2590}}},{"type":"text","value":" for them to work.","position":{"start":{"line":91,"column":45,"offset":2590},"end":{"line":91,"column":63,"offset":2608}}}],"position":{"start":{"line":91,"column":1,"offset":2546},"end":{"line":91,"column":63,"offset":2608}}},{"type":"text","value":"\n"}],"position":{"start":{"line":90,"column":1,"offset":2492},"end":{"line":91,"column":63,"offset":2608}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function showAvatar() {\n    // read our JSON\n    let response = await fetch('/article/promise-chaining/user.json');\n    let user = await response.json();\n\n    // read github user\n    let githubResponse = await fetch(`https://api.github.com/users/${user.name}`);\n    let githubUser = await githubResponse.json();\n\n    // show the avatar\n    let img = document.createElement('img');\n    img.src = githubUser.avatar_url;\n    img.className = 'promise-avatar-example';\n    document.body.append(img);\n\n    // wait 3 seconds\n    await new Promise((resolve, reject) => setTimeout(resolve, 3000));\n\n    img.remove();\n\n    return githubUser;\n}\n\nshowAvatar();\n"}],"position":{"start":{"line":93,"column":1,"offset":2610},"end":{"line":118,"column":4,"offset":3274}}}],"position":{"start":{"line":93,"column":1,"offset":2610},"end":{"line":118,"column":4,"offset":3274}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pretty clean and easy to read, right? Much better than before.","position":{"start":{"line":120,"column":1,"offset":3276},"end":{"line":120,"column":63,"offset":3338}}}],"position":{"start":{"line":120,"column":1,"offset":3276},"end":{"line":120,"column":63,"offset":3338}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"await` won't work in the top-level code\n\nPeople who are just starting to use `await` tend to forget the fact that we can't use `await` in top-level code. For example, this will not work:\n\n```js\n// syntax error in top-level code\nlet response = await fetch('/article/promise-chaining/user.json');\nlet user = await response.json();\n"}],"position":{"start":{"line":122,"column":1,"offset":3340},"end":{"line":131,"column":4,"offset":3678}}}],"position":{"start":{"line":122,"column":1,"offset":3340},"end":{"line":131,"column":4,"offset":3678}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But we can wrap it into an anonymous async function, like this:","position":{"start":{"line":133,"column":1,"offset":3680},"end":{"line":133,"column":64,"offset":3743}}}],"position":{"start":{"line":133,"column":1,"offset":3680},"end":{"line":133,"column":64,"offset":3743}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"(async () => {\n  let response = await fetch('/article/promise-chaining/user.json');\n  let user = await response.json();\n  ...\n})();\n"}],"position":{"start":{"line":135,"column":1,"offset":3745},"end":{"line":141,"column":4,"offset":3886}}}],"position":{"start":{"line":135,"column":1,"offset":3745},"end":{"line":141,"column":4,"offset":3886}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"P.S. New feature: starting from V8 engine version 8.9+, top-level await works in ","position":{"start":{"line":143,"column":1,"offset":3888},"end":{"line":143,"column":82,"offset":3969}}},{"type":"element","tagName":"a","properties":{"href":"modules"},"children":[{"type":"text","value":"modules","position":{"start":{"line":143,"column":83,"offset":3970},"end":{"line":143,"column":90,"offset":3977}}}],"position":{"start":{"line":143,"column":82,"offset":3969},"end":{"line":143,"column":100,"offset":3987}}},{"type":"text","value":".","position":{"start":{"line":143,"column":100,"offset":3987},"end":{"line":143,"column":101,"offset":3988}}}],"position":{"start":{"line":143,"column":1,"offset":3888},"end":{"line":143,"column":101,"offset":3988}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"await` accepts \"thenables\"\n\nLike `promise.then`, `await` allows us to use thenable objects (those with a callable `then` method). The idea is that a third-party object may not be a promise, but promise-compatible: if it supports `.then`, that's enough to use it with `await`.\n\nHere's a demo `Thenable` class; the `await` below accepts its instances:\n\n```js\nclass Thenable {\n  constructor(num) {\n    this.num = num;\n  }\n  then(resolve, reject) {\n    alert(resolve);\n    // resolve with this.num*2 after 1000ms\n    setTimeout(() => resolve(this.num * 2), 1000); // (*)\n  }\n}\n\nasync function f() {\n  // waits for 1 second, then result becomes 2\n  let result = await new Thenable(1);\n  alert(result);\n}\n\nf();\n"}],"position":{"start":{"line":145,"column":1,"offset":3990},"end":{"line":171,"column":4,"offset":4704}}}],"position":{"start":{"line":145,"column":1,"offset":3990},"end":{"line":171,"column":4,"offset":4704}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If ","position":{"start":{"line":173,"column":1,"offset":4706},"end":{"line":173,"column":4,"offset":4709}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":173,"column":4,"offset":4709},"end":{"line":173,"column":11,"offset":4716}}},{"type":"text","value":" gets a non-promise object with ","position":{"start":{"line":173,"column":11,"offset":4716},"end":{"line":173,"column":43,"offset":4748}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".then"}],"position":{"start":{"line":173,"column":43,"offset":4748},"end":{"line":173,"column":50,"offset":4755}}},{"type":"text","value":", it calls that method providing the built-in functions ","position":{"start":{"line":173,"column":50,"offset":4755},"end":{"line":173,"column":106,"offset":4811}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"resolve"}],"position":{"start":{"line":173,"column":106,"offset":4811},"end":{"line":173,"column":115,"offset":4820}}},{"type":"text","value":" and ","position":{"start":{"line":173,"column":115,"offset":4820},"end":{"line":173,"column":120,"offset":4825}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"reject"}],"position":{"start":{"line":173,"column":120,"offset":4825},"end":{"line":173,"column":128,"offset":4833}}},{"type":"text","value":" as arguments (just as it does for a regular ","position":{"start":{"line":173,"column":128,"offset":4833},"end":{"line":173,"column":173,"offset":4878}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Promise"}],"position":{"start":{"line":173,"column":173,"offset":4878},"end":{"line":173,"column":182,"offset":4887}}},{"type":"text","value":" executor). Then ","position":{"start":{"line":173,"column":182,"offset":4887},"end":{"line":173,"column":199,"offset":4904}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":173,"column":199,"offset":4904},"end":{"line":173,"column":206,"offset":4911}}},{"type":"text","value":" waits until one of them is called (in the example above it happens in the line ","position":{"start":{"line":173,"column":206,"offset":4911},"end":{"line":173,"column":286,"offset":4991}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"(*)"}],"position":{"start":{"line":173,"column":286,"offset":4991},"end":{"line":173,"column":291,"offset":4996}}},{"type":"text","value":") and then proceeds with the result.","position":{"start":{"line":173,"column":291,"offset":4996},"end":{"line":173,"column":327,"offset":5032}}}],"position":{"start":{"line":173,"column":1,"offset":4706},"end":{"line":173,"column":327,"offset":5032}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Async class methods","position":{"start":{"line":175,"column":1,"offset":5034},"end":{"line":175,"column":20,"offset":5053}}}],"position":{"start":{"line":175,"column":1,"offset":5034},"end":{"line":175,"column":20,"offset":5053}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To declare an async class method, just prepend it with ","position":{"start":{"line":177,"column":1,"offset":5055},"end":{"line":177,"column":56,"offset":5110}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":177,"column":56,"offset":5110},"end":{"line":177,"column":63,"offset":5117}}},{"type":"text","value":":","position":{"start":{"line":177,"column":63,"offset":5117},"end":{"line":177,"column":64,"offset":5118}}}],"position":{"start":{"line":177,"column":1,"offset":5055},"end":{"line":177,"column":64,"offset":5118}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"class Waiter {\n    async wait() {\n        return await Promise.resolve(1);\n    }\n}\n\nnew Waiter().wait().then(alert); // 1 (this is the same as (result => alert(result)))\n"}],"position":{"start":{"line":179,"column":1,"offset":5120},"end":{"line":187,"column":4,"offset":5299}}}],"position":{"start":{"line":179,"column":1,"offset":5120},"end":{"line":187,"column":4,"offset":5299}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The meaning is the same: it ensures that the returned value is a promise and enables ","position":{"start":{"line":189,"column":1,"offset":5301},"end":{"line":189,"column":86,"offset":5386}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":189,"column":86,"offset":5386},"end":{"line":189,"column":93,"offset":5393}}},{"type":"text","value":".","position":{"start":{"line":189,"column":93,"offset":5393},"end":{"line":189,"column":94,"offset":5394}}}],"position":{"start":{"line":189,"column":1,"offset":5301},"end":{"line":189,"column":94,"offset":5394}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"[Error handling]","position":{"start":{"line":191,"column":5,"offset":5400},"end":{"line":191,"column":19,"offset":5414}}}],"position":{"start":{"line":191,"column":1,"offset":5396},"end":{"line":191,"column":20,"offset":5415}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If a promise resolves normally, then ","position":{"start":{"line":193,"column":1,"offset":5417},"end":{"line":193,"column":38,"offset":5454}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await promise"}],"position":{"start":{"line":193,"column":38,"offset":5454},"end":{"line":193,"column":53,"offset":5469}}},{"type":"text","value":" returns the result. But in the case of a rejection, it throws the error, just as if there were a ","position":{"start":{"line":193,"column":53,"offset":5469},"end":{"line":193,"column":151,"offset":5567}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"throw"}],"position":{"start":{"line":193,"column":151,"offset":5567},"end":{"line":193,"column":158,"offset":5574}}},{"type":"text","value":" statement at that line.","position":{"start":{"line":193,"column":158,"offset":5574},"end":{"line":193,"column":182,"offset":5598}}}],"position":{"start":{"line":193,"column":1,"offset":5417},"end":{"line":193,"column":182,"offset":5598}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This code:","position":{"start":{"line":195,"column":1,"offset":5600},"end":{"line":195,"column":11,"offset":5610}}}],"position":{"start":{"line":195,"column":1,"offset":5600},"end":{"line":195,"column":11,"offset":5610}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    await Promise.reject(new Error('Whoops!'));\n}\n"}],"position":{"start":{"line":197,"column":1,"offset":5612},"end":{"line":201,"column":4,"offset":5692}}}],"position":{"start":{"line":197,"column":1,"offset":5612},"end":{"line":201,"column":4,"offset":5692}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"...is the same as this:","position":{"start":{"line":203,"column":1,"offset":5694},"end":{"line":203,"column":24,"offset":5717}}}],"position":{"start":{"line":203,"column":1,"offset":5694},"end":{"line":203,"column":24,"offset":5717}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    throw new Error('Whoops!');\n}\n"}],"position":{"start":{"line":205,"column":1,"offset":5719},"end":{"line":209,"column":4,"offset":5783}}}],"position":{"start":{"line":205,"column":1,"offset":5719},"end":{"line":209,"column":4,"offset":5783}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In real situations, the promise may take some time before it rejects. In that case there will be a delay before ","position":{"start":{"line":211,"column":1,"offset":5785},"end":{"line":211,"column":113,"offset":5897}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":211,"column":113,"offset":5897},"end":{"line":211,"column":120,"offset":5904}}},{"type":"text","value":" throws an error.","position":{"start":{"line":211,"column":120,"offset":5904},"end":{"line":211,"column":137,"offset":5921}}}],"position":{"start":{"line":211,"column":1,"offset":5785},"end":{"line":211,"column":137,"offset":5921}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can catch that error using ","position":{"start":{"line":213,"column":1,"offset":5923},"end":{"line":213,"column":31,"offset":5953}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"try..catch"}],"position":{"start":{"line":213,"column":31,"offset":5953},"end":{"line":213,"column":43,"offset":5965}}},{"type":"text","value":", the same way as a regular ","position":{"start":{"line":213,"column":43,"offset":5965},"end":{"line":213,"column":71,"offset":5993}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"throw"}],"position":{"start":{"line":213,"column":71,"offset":5993},"end":{"line":213,"column":78,"offset":6000}}},{"type":"text","value":":","position":{"start":{"line":213,"column":78,"offset":6000},"end":{"line":213,"column":79,"offset":6001}}}],"position":{"start":{"line":213,"column":1,"offset":5923},"end":{"line":213,"column":79,"offset":6001}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    try {\n        let response = await fetch('http://no-such-url');\n    } catch (err) {\n        alert(err); // TypeError: failed to fetch\n    }\n}\n\nf();\n"}],"position":{"start":{"line":215,"column":1,"offset":6003},"end":{"line":225,"column":4,"offset":6185}}}],"position":{"start":{"line":215,"column":1,"offset":6003},"end":{"line":225,"column":4,"offset":6185}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In the case of an error, the control jumps to the ","position":{"start":{"line":227,"column":1,"offset":6187},"end":{"line":227,"column":51,"offset":6237}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"catch"}],"position":{"start":{"line":227,"column":51,"offset":6237},"end":{"line":227,"column":58,"offset":6244}}},{"type":"text","value":" block. We can also wrap multiple lines:","position":{"start":{"line":227,"column":58,"offset":6244},"end":{"line":227,"column":98,"offset":6284}}}],"position":{"start":{"line":227,"column":1,"offset":6187},"end":{"line":227,"column":98,"offset":6284}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    try {\n        let response = await fetch('/no-user-here');\n        let user = await response.json();\n    } catch (err) {\n        // catches errors both in fetch and response.json\n        alert(err);\n    }\n}\n\nf();\n"}],"position":{"start":{"line":229,"column":1,"offset":6286},"end":{"line":241,"column":4,"offset":6533}}}],"position":{"start":{"line":229,"column":1,"offset":6286},"end":{"line":241,"column":4,"offset":6533}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we don't have ","position":{"start":{"line":243,"column":1,"offset":6535},"end":{"line":243,"column":18,"offset":6552}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"try..catch"}],"position":{"start":{"line":243,"column":18,"offset":6552},"end":{"line":243,"column":30,"offset":6564}}},{"type":"text","value":", then the promise generated by the call of the async function ","position":{"start":{"line":243,"column":30,"offset":6564},"end":{"line":243,"column":93,"offset":6627}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"f()"}],"position":{"start":{"line":243,"column":93,"offset":6627},"end":{"line":243,"column":98,"offset":6632}}},{"type":"text","value":" becomes rejected. We can append ","position":{"start":{"line":243,"column":98,"offset":6632},"end":{"line":243,"column":131,"offset":6665}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".catch"}],"position":{"start":{"line":243,"column":131,"offset":6665},"end":{"line":243,"column":139,"offset":6673}}},{"type":"text","value":" to handle it:","position":{"start":{"line":243,"column":139,"offset":6673},"end":{"line":243,"column":153,"offset":6687}}}],"position":{"start":{"line":243,"column":1,"offset":6535},"end":{"line":243,"column":153,"offset":6687}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    let response = await fetch('http://no-such-url');\n}\n\n// f() becomes a rejected promise\nf().catch(alert); // TypeError: failed to fetch // (*)\n"}],"position":{"start":{"line":245,"column":1,"offset":6689},"end":{"line":252,"column":4,"offset":6865}}}],"position":{"start":{"line":245,"column":1,"offset":6689},"end":{"line":252,"column":4,"offset":6865}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we forget to add ","position":{"start":{"line":254,"column":1,"offset":6867},"end":{"line":254,"column":21,"offset":6887}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".catch"}],"position":{"start":{"line":254,"column":21,"offset":6887},"end":{"line":254,"column":29,"offset":6895}}},{"type":"text","value":" there, then we get an unhandled promise error (viewable in the console). We can catch such errors using a global ","position":{"start":{"line":254,"column":29,"offset":6895},"end":{"line":254,"column":143,"offset":7009}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"unhandledrejection"}],"position":{"start":{"line":254,"column":143,"offset":7009},"end":{"line":254,"column":163,"offset":7029}}},{"type":"text","value":" event handler as described in the chapter ","position":{"start":{"line":254,"column":163,"offset":7029},"end":{"line":254,"column":206,"offset":7072}}},{"type":"element","tagName":"a","properties":{"href":"promise-error-handling"},"children":[{"type":"text","value":"Error handling with promises","position":{"start":{"line":254,"column":207,"offset":7073},"end":{"line":254,"column":235,"offset":7101}}}],"position":{"start":{"line":254,"column":206,"offset":7072},"end":{"line":254,"column":260,"offset":7126}}},{"type":"text","value":".","position":{"start":{"line":254,"column":260,"offset":7126},"end":{"line":254,"column":261,"offset":7127}}}],"position":{"start":{"line":254,"column":1,"offset":6867},"end":{"line":254,"column":261,"offset":7127}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async/await` and `promise.then/catch\n"}],"position":{"start":{"line":256,"column":1,"offset":7129},"end":{"line":258,"column":4,"offset":7175}}}],"position":{"start":{"line":256,"column":1,"offset":7129},"end":{"line":258,"column":4,"offset":7175}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When we use ","position":{"start":{"line":260,"column":1,"offset":7177},"end":{"line":260,"column":13,"offset":7189}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async/await"}],"position":{"start":{"line":260,"column":13,"offset":7189},"end":{"line":260,"column":26,"offset":7202}}},{"type":"text","value":", we rarely need ","position":{"start":{"line":260,"column":26,"offset":7202},"end":{"line":260,"column":43,"offset":7219}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".then"}],"position":{"start":{"line":260,"column":43,"offset":7219},"end":{"line":260,"column":50,"offset":7226}}},{"type":"text","value":", because ","position":{"start":{"line":260,"column":50,"offset":7226},"end":{"line":260,"column":60,"offset":7236}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":260,"column":60,"offset":7236},"end":{"line":260,"column":67,"offset":7243}}},{"type":"text","value":" handles the waiting for us. And we can use a regular ","position":{"start":{"line":260,"column":67,"offset":7243},"end":{"line":260,"column":121,"offset":7297}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"try..catch"}],"position":{"start":{"line":260,"column":121,"offset":7297},"end":{"line":260,"column":133,"offset":7309}}},{"type":"text","value":" instead of ","position":{"start":{"line":260,"column":133,"offset":7309},"end":{"line":260,"column":145,"offset":7321}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".catch"}],"position":{"start":{"line":260,"column":145,"offset":7321},"end":{"line":260,"column":153,"offset":7329}}},{"type":"text","value":". That's usually (but not always) more convenient.","position":{"start":{"line":260,"column":153,"offset":7329},"end":{"line":260,"column":203,"offset":7379}}}],"position":{"start":{"line":260,"column":1,"offset":7177},"end":{"line":260,"column":203,"offset":7379}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But at the top level of the code, when we're outside any ","position":{"start":{"line":262,"column":1,"offset":7381},"end":{"line":262,"column":58,"offset":7438}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":262,"column":58,"offset":7438},"end":{"line":262,"column":65,"offset":7445}}},{"type":"text","value":" function, we're syntactically unable to use ","position":{"start":{"line":262,"column":65,"offset":7445},"end":{"line":262,"column":110,"offset":7490}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":262,"column":110,"offset":7490},"end":{"line":262,"column":117,"offset":7497}}},{"type":"text","value":", so it's a normal practice to add ","position":{"start":{"line":262,"column":117,"offset":7497},"end":{"line":262,"column":152,"offset":7532}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".then/catch"}],"position":{"start":{"line":262,"column":152,"offset":7532},"end":{"line":262,"column":165,"offset":7545}}},{"type":"text","value":" to handle the final result or falling-through error, like in the line ","position":{"start":{"line":262,"column":165,"offset":7545},"end":{"line":262,"column":236,"offset":7616}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"(*)"}],"position":{"start":{"line":262,"column":236,"offset":7616},"end":{"line":262,"column":241,"offset":7621}}},{"type":"text","value":" of the example above.","position":{"start":{"line":262,"column":241,"offset":7621},"end":{"line":262,"column":263,"offset":7643}}}],"position":{"start":{"line":262,"column":1,"offset":7381},"end":{"line":262,"column":263,"offset":7643}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async/await` works well with `Promise.all\n"}],"position":{"start":{"line":264,"column":1,"offset":7645},"end":{"line":266,"column":4,"offset":7696}}}],"position":{"start":{"line":264,"column":1,"offset":7645},"end":{"line":266,"column":4,"offset":7696}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When we need to wait for multiple promises, we can wrap them in ","position":{"start":{"line":268,"column":1,"offset":7698},"end":{"line":268,"column":65,"offset":7762}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Promise.all"}],"position":{"start":{"line":268,"column":65,"offset":7762},"end":{"line":268,"column":78,"offset":7775}}},{"type":"text","value":" and then ","position":{"start":{"line":268,"column":78,"offset":7775},"end":{"line":268,"column":88,"offset":7785}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":268,"column":88,"offset":7785},"end":{"line":268,"column":95,"offset":7792}}},{"type":"text","value":":","position":{"start":{"line":268,"column":95,"offset":7792},"end":{"line":268,"column":96,"offset":7793}}}],"position":{"start":{"line":268,"column":1,"offset":7698},"end":{"line":268,"column":96,"offset":7793}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"// wait for the array of results\nlet results = await Promise.all([\n  fetch(url1),\n  fetch(url2),\n  ...\n]);\n"}],"position":{"start":{"line":270,"column":1,"offset":7795},"end":{"line":277,"column":4,"offset":7911}}}],"position":{"start":{"line":270,"column":1,"offset":7795},"end":{"line":277,"column":4,"offset":7911}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In the case of an error, it propagates as usual, from the failed promise to ","position":{"start":{"line":279,"column":1,"offset":7913},"end":{"line":279,"column":77,"offset":7989}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Promise.all"}],"position":{"start":{"line":279,"column":77,"offset":7989},"end":{"line":279,"column":90,"offset":8002}}},{"type":"text","value":", and then becomes an exception that we can catch using ","position":{"start":{"line":279,"column":90,"offset":8002},"end":{"line":279,"column":146,"offset":8058}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"try..catch"}],"position":{"start":{"line":279,"column":146,"offset":8058},"end":{"line":279,"column":158,"offset":8070}}},{"type":"text","value":" around the call.","position":{"start":{"line":279,"column":158,"offset":8070},"end":{"line":279,"column":175,"offset":8087}}}],"position":{"start":{"line":279,"column":1,"offset":7913},"end":{"line":279,"column":175,"offset":8087}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#summary"},"children":[{"type":"text","value":"Summary","position":{"start":{"line":281,"column":5,"offset":8093},"end":{"line":281,"column":12,"offset":8100}}}],"position":{"start":{"line":281,"column":4,"offset":8092},"end":{"line":281,"column":23,"offset":8111}}}],"position":{"start":{"line":281,"column":1,"offset":8089},"end":{"line":281,"column":23,"offset":8111}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The ","position":{"start":{"line":283,"column":1,"offset":8113},"end":{"line":283,"column":5,"offset":8117}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":283,"column":5,"offset":8117},"end":{"line":283,"column":12,"offset":8124}}},{"type":"text","value":" keyword before a function has two effects:","position":{"start":{"line":283,"column":12,"offset":8124},"end":{"line":283,"column":55,"offset":8167}}}],"position":{"start":{"line":283,"column":1,"offset":8113},"end":{"line":283,"column":55,"offset":8167}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Makes it always return a promise.","position":{"start":{"line":285,"column":5,"offset":8173},"end":{"line":285,"column":38,"offset":8206}}}],"position":{"start":{"line":285,"column":1,"offset":8169},"end":{"line":285,"column":38,"offset":8206}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Allows ","position":{"start":{"line":286,"column":5,"offset":8211},"end":{"line":286,"column":12,"offset":8218}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":286,"column":12,"offset":8218},"end":{"line":286,"column":19,"offset":8225}}},{"type":"text","value":" to be used in it.","position":{"start":{"line":286,"column":19,"offset":8225},"end":{"line":286,"column":37,"offset":8243}}}],"position":{"start":{"line":286,"column":1,"offset":8207},"end":{"line":286,"column":37,"offset":8243}}},{"type":"text","value":"\n"}],"position":{"start":{"line":285,"column":1,"offset":8169},"end":{"line":286,"column":37,"offset":8243}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The ","position":{"start":{"line":288,"column":1,"offset":8245},"end":{"line":288,"column":5,"offset":8249}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":288,"column":5,"offset":8249},"end":{"line":288,"column":12,"offset":8256}}},{"type":"text","value":" keyword before a promise makes JavaScript wait until that promise settles, and then:","position":{"start":{"line":288,"column":12,"offset":8256},"end":{"line":288,"column":97,"offset":8341}}}],"position":{"start":{"line":288,"column":1,"offset":8245},"end":{"line":288,"column":97,"offset":8341}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"If it's an error, the exception is generated --- same as if ","position":{"start":{"line":290,"column":5,"offset":8347},"end":{"line":290,"column":65,"offset":8407}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"throw error"}],"position":{"start":{"line":290,"column":65,"offset":8407},"end":{"line":290,"column":78,"offset":8420}}},{"type":"text","value":" were called at that very place.","position":{"start":{"line":290,"column":78,"offset":8420},"end":{"line":290,"column":110,"offset":8452}}}],"position":{"start":{"line":290,"column":1,"offset":8343},"end":{"line":290,"column":110,"offset":8452}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Otherwise, it returns the result.","position":{"start":{"line":291,"column":5,"offset":8457},"end":{"line":291,"column":38,"offset":8490}}}],"position":{"start":{"line":291,"column":1,"offset":8453},"end":{"line":291,"column":38,"offset":8490}}},{"type":"text","value":"\n"}],"position":{"start":{"line":290,"column":1,"offset":8343},"end":{"line":291,"column":38,"offset":8490}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Together they provide a great framework to write asynchronous code that is easy to both read and write.","position":{"start":{"line":293,"column":1,"offset":8492},"end":{"line":293,"column":104,"offset":8595}}}],"position":{"start":{"line":293,"column":1,"offset":8492},"end":{"line":293,"column":104,"offset":8595}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With ","position":{"start":{"line":295,"column":1,"offset":8597},"end":{"line":295,"column":6,"offset":8602}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async/await"}],"position":{"start":{"line":295,"column":6,"offset":8602},"end":{"line":295,"column":19,"offset":8615}}},{"type":"text","value":" we rarely need to write ","position":{"start":{"line":295,"column":19,"offset":8615},"end":{"line":295,"column":44,"offset":8640}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"promise.then/catch"}],"position":{"start":{"line":295,"column":44,"offset":8640},"end":{"line":295,"column":64,"offset":8660}}},{"type":"text","value":", but we still shouldn't forget that they are based on promises, because sometimes (e.g. in the outermost scope) we have to use these methods. Also ","position":{"start":{"line":295,"column":64,"offset":8660},"end":{"line":295,"column":212,"offset":8808}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Promise.all"}],"position":{"start":{"line":295,"column":212,"offset":8808},"end":{"line":295,"column":225,"offset":8821}}},{"type":"text","value":" is nice when we are waiting for many tasks simultaneously.","position":{"start":{"line":295,"column":225,"offset":8821},"end":{"line":295,"column":284,"offset":8880}}}],"position":{"start":{"line":295,"column":1,"offset":8597},"end":{"line":295,"column":284,"offset":8880}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Cleaning up your asynchronous code with ","position":{"start":{"line":297,"column":4,"offset":8885},"end":{"line":297,"column":44,"offset":8925}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":297,"column":44,"offset":8925},"end":{"line":297,"column":51,"offset":8932}}}],"position":{"start":{"line":297,"column":1,"offset":8882},"end":{"line":297,"column":51,"offset":8932}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"REPLs have traditionally had a difficult time allowing you to interact with asynchronous code since they encourage a coding style where you evaluate expressions and use those results in the next field. But if you are using promises or callbacks, this breaks down because these results exist only in the callback, not the next line:","position":{"start":{"line":299,"column":1,"offset":8934},"end":{"line":299,"column":332,"offset":9265}}}],"position":{"start":{"line":299,"column":1,"offset":8934},"end":{"line":299,"column":332,"offset":9265}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In RunKit, you can use top-level ","position":{"start":{"line":301,"column":1,"offset":9267},"end":{"line":301,"column":34,"offset":9300}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":301,"column":34,"offset":9300},"end":{"line":301,"column":41,"offset":9307}}},{"type":"text","value":" to get the same behavior of synchronous code.","position":{"start":{"line":301,"column":41,"offset":9307},"end":{"line":301,"column":87,"offset":9353}}}],"position":{"start":{"line":301,"column":1,"offset":9267},"end":{"line":301,"column":87,"offset":9353}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we can treat this code as synchronous, despite the fact that the code is still executing asynchronously.","position":{"start":{"line":303,"column":1,"offset":9355},"end":{"line":303,"column":109,"offset":9463}}}],"position":{"start":{"line":303,"column":1,"offset":9355},"end":{"line":303,"column":109,"offset":9463}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's look how. It helps to have a more complex example, where we need to do a few asynchronous operations in sequence. You can see how ","position":{"start":{"line":305,"column":1,"offset":9465},"end":{"line":305,"column":137,"offset":9601}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":305,"column":137,"offset":9601},"end":{"line":305,"column":144,"offset":9608}}},{"type":"text","value":", promises and callbacks achieve the same results, but the ","position":{"start":{"line":305,"column":144,"offset":9608},"end":{"line":305,"column":203,"offset":9667}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":305,"column":203,"offset":9667},"end":{"line":305,"column":210,"offset":9674}}},{"type":"text","value":" style works better in a REPL:","position":{"start":{"line":305,"column":210,"offset":9674},"end":{"line":305,"column":240,"offset":9704}}}],"position":{"start":{"line":305,"column":1,"offset":9465},"end":{"line":305,"column":240,"offset":9704}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"await","position":{"start":{"line":307,"column":3,"offset":9708},"end":{"line":307,"column":8,"offset":9713}}}],"position":{"start":{"line":307,"column":1,"offset":9706},"end":{"line":307,"column":8,"offset":9713}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"promises","position":{"start":{"line":308,"column":3,"offset":9716},"end":{"line":308,"column":11,"offset":9724}}}],"position":{"start":{"line":308,"column":1,"offset":9714},"end":{"line":308,"column":11,"offset":9724}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"callbacks","position":{"start":{"line":309,"column":3,"offset":9727},"end":{"line":309,"column":12,"offset":9736}}}],"position":{"start":{"line":309,"column":1,"offset":9725},"end":{"line":309,"column":12,"offset":9736}}},{"type":"text","value":"\n"}],"position":{"start":{"line":307,"column":1,"offset":9706},"end":{"line":309,"column":12,"offset":9736}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Here, we use ","position":{"start":{"line":311,"column":1,"offset":9738},"end":{"line":311,"column":14,"offset":9751}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":311,"column":14,"offset":9751},"end":{"line":311,"column":21,"offset":9758}}},{"type":"text","value":" on lines 4 and 8, and the results from each request remain in scope.","position":{"start":{"line":311,"column":21,"offset":9758},"end":{"line":311,"column":90,"offset":9827}}}],"position":{"start":{"line":311,"column":1,"offset":9738},"end":{"line":311,"column":90,"offset":9827}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Remember, ","position":{"start":{"line":313,"column":1,"offset":9829},"end":{"line":313,"column":11,"offset":9839}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":313,"column":11,"offset":9839},"end":{"line":313,"column":18,"offset":9846}}},{"type":"text","value":" expects a ","position":{"start":{"line":313,"column":18,"offset":9846},"end":{"line":313,"column":29,"offset":9857}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"promise"}],"position":{"start":{"line":313,"column":29,"offset":9857},"end":{"line":313,"column":38,"offset":9866}}},{"type":"text","value":" so you can either write your own or use one of the many libraries that natively supports promises, and npm is full of packages that add promise support to existing libraries. Here are a few of our favorites:","position":{"start":{"line":313,"column":38,"offset":9866},"end":{"line":313,"column":246,"offset":10074}}}],"position":{"start":{"line":313,"column":1,"offset":9829},"end":{"line":313,"column":246,"offset":10074}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://npm.runkit.com/fs-promise"},"children":[{"type":"text","value":"fs-promise","position":{"start":{"line":315,"column":4,"offset":10079},"end":{"line":315,"column":14,"offset":10089}}}],"position":{"start":{"line":315,"column":3,"offset":10078},"end":{"line":315,"column":50,"offset":10125}}},{"type":"text","value":" - promise based filesystem api","position":{"start":{"line":315,"column":50,"offset":10125},"end":{"line":315,"column":81,"offset":10156}}}],"position":{"start":{"line":315,"column":1,"offset":10076},"end":{"line":315,"column":81,"offset":10156}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://npm.runkit.com/request-promise"},"children":[{"type":"text","value":"request-promise","position":{"start":{"line":316,"column":4,"offset":10160},"end":{"line":316,"column":19,"offset":10175}}}],"position":{"start":{"line":316,"column":3,"offset":10159},"end":{"line":316,"column":60,"offset":10216}}},{"type":"text","value":" - a wrapper around \"request\" for http stuff","position":{"start":{"line":316,"column":60,"offset":10216},"end":{"line":316,"column":104,"offset":10260}}}],"position":{"start":{"line":316,"column":1,"offset":10157},"end":{"line":316,"column":104,"offset":10260}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://npm.runkit.com/glob-promise"},"children":[{"type":"text","value":"glob-promise","position":{"start":{"line":317,"column":4,"offset":10264},"end":{"line":317,"column":16,"offset":10276}}}],"position":{"start":{"line":317,"column":3,"offset":10263},"end":{"line":317,"column":54,"offset":10314}}},{"type":"text","value":" - glob style filesystem queries","position":{"start":{"line":317,"column":54,"offset":10314},"end":{"line":317,"column":86,"offset":10346}}}],"position":{"start":{"line":317,"column":1,"offset":10261},"end":{"line":317,"column":86,"offset":10346}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://npm.runkit.com/bluebird"},"children":[{"type":"text","value":"bluebird","position":{"start":{"line":318,"column":4,"offset":10350},"end":{"line":318,"column":12,"offset":10358}}}],"position":{"start":{"line":318,"column":3,"offset":10349},"end":{"line":318,"column":46,"offset":10392}}},{"type":"text","value":" - general promise library with lots of utilities","position":{"start":{"line":318,"column":46,"offset":10392},"end":{"line":318,"column":95,"offset":10441}}}],"position":{"start":{"line":318,"column":1,"offset":10347},"end":{"line":318,"column":95,"offset":10441}}},{"type":"text","value":"\n"}],"position":{"start":{"line":315,"column":1,"offset":10076},"end":{"line":318,"column":95,"offset":10441}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Further Reading","position":{"start":{"line":320,"column":5,"offset":10447},"end":{"line":320,"column":20,"offset":10462}}}],"position":{"start":{"line":320,"column":1,"offset":10443},"end":{"line":320,"column":20,"offset":10462}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://rossboucher.com/await"},"children":[{"type":"text","value":"ES7 Async/Await presented at Brookyln.js","position":{"start":{"line":322,"column":4,"offset":10467},"end":{"line":322,"column":44,"offset":10507}}}],"position":{"start":{"line":322,"column":3,"offset":10466},"end":{"line":322,"column":75,"offset":10538}}}],"position":{"start":{"line":322,"column":1,"offset":10464},"end":{"line":322,"column":75,"offset":10538}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://babeljs.io/"},"children":[{"type":"text","value":"Babel.js","position":{"start":{"line":323,"column":4,"offset":10542},"end":{"line":323,"column":12,"offset":10550}}}],"position":{"start":{"line":323,"column":3,"offset":10541},"end":{"line":323,"column":34,"offset":10572}}}],"position":{"start":{"line":323,"column":1,"offset":10539},"end":{"line":323,"column":34,"offset":10572}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/lukehoban/ecmascript-asyncawait/"},"children":[{"type":"text","value":"ECMAScript's Proposal for async/await","position":{"start":{"line":324,"column":4,"offset":10576},"end":{"line":324,"column":41,"offset":10613}}}],"position":{"start":{"line":324,"column":3,"offset":10575},"end":{"line":324,"column":95,"offset":10667}}}],"position":{"start":{"line":324,"column":1,"offset":10573},"end":{"line":324,"column":95,"offset":10667}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://esdiscuss.org/notes/2014-01-30#async-await"},"children":[{"type":"text","value":"ES Meeting Notes discussing on async/await","position":{"start":{"line":325,"column":4,"offset":10671},"end":{"line":325,"column":46,"offset":10713}}}],"position":{"start":{"line":325,"column":3,"offset":10670},"end":{"line":325,"column":99,"offset":10766}}}],"position":{"start":{"line":325,"column":1,"offset":10668},"end":{"line":325,"column":99,"offset":10766}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://esdiscuss.org/topic/does-async-await-solve-a-real-problem"},"children":[{"type":"text","value":"Does async/await Solve a Real Problem?","position":{"start":{"line":326,"column":4,"offset":10770},"end":{"line":326,"column":42,"offset":10808}}}],"position":{"start":{"line":326,"column":3,"offset":10769},"end":{"line":326,"column":110,"offset":10876}}}],"position":{"start":{"line":326,"column":1,"offset":10767},"end":{"line":326,"column":110,"offset":10876}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://thomashunter.name/blog/the-long-road-to-asyncawait-in-javascript/"},"children":[{"type":"text","value":"The Long Road to async/await in JavaScript","position":{"start":{"line":327,"column":4,"offset":10880},"end":{"line":327,"column":46,"offset":10922}}}],"position":{"start":{"line":327,"column":3,"offset":10879},"end":{"line":327,"column":122,"offset":10998}}}],"position":{"start":{"line":327,"column":1,"offset":10877},"end":{"line":327,"column":122,"offset":10998}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.twilio.com/blog/2015/10/asyncawait-the-hero-javascript-deserved.html"},"children":[{"type":"text","value":"async/await: The Hero JavaScript Deserved","position":{"start":{"line":328,"column":4,"offset":11002},"end":{"line":328,"column":45,"offset":11043}}}],"position":{"start":{"line":328,"column":3,"offset":11001},"end":{"line":328,"column":128,"offset":11126}}}],"position":{"start":{"line":328,"column":1,"offset":10999},"end":{"line":328,"column":128,"offset":11126}}},{"type":"text","value":"\n"}],"position":{"start":{"line":322,"column":1,"offset":10464},"end":{"line":328,"column":128,"offset":11126}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":329,"column":1,"offset":11127}}}}