{"expireTime":9007200903816788000,"key":"transformer-remark-markdown-html-ast-33b787fa84220161e45564b26907ef17--","val":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Async functions:","position":{"start":{"line":1,"column":3,"offset":2},"end":{"line":1,"column":19,"offset":18}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":19,"offset":18}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Asynchronous JavaScript","position":{"start":{"line":2,"column":4,"offset":23},"end":{"line":2,"column":27,"offset":46}}}],"position":{"start":{"line":2,"column":1,"offset":20},"end":{"line":2,"column":27,"offset":46}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's start with the ","position":{"start":{"line":4,"column":1,"offset":50},"end":{"line":4,"column":22,"offset":71}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":4,"column":22,"offset":71},"end":{"line":4,"column":29,"offset":78}}},{"type":"text","value":" keyword. It can be placed before a function, like this:","position":{"start":{"line":4,"column":29,"offset":78},"end":{"line":4,"column":85,"offset":134}}}],"position":{"start":{"line":4,"column":1,"offset":50},"end":{"line":4,"column":85,"offset":134}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    return 1;\n}\n"}],"position":{"start":{"line":6,"column":1,"offset":138},"end":{"line":10,"column":4,"offset":188}}}],"position":{"start":{"line":6,"column":1,"offset":138},"end":{"line":10,"column":4,"offset":188}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The word \"async\" before a function means one simple thing: a function always returns a promise. Other values are wrapped in a resolved promise automatically.","position":{"start":{"line":12,"column":1,"offset":192},"end":{"line":12,"column":158,"offset":349}}}],"position":{"start":{"line":12,"column":1,"offset":192},"end":{"line":12,"column":158,"offset":349}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For instance, this function returns a resolved promise with the result of ","position":{"start":{"line":14,"column":1,"offset":353},"end":{"line":14,"column":75,"offset":427}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"1"}],"position":{"start":{"line":14,"column":75,"offset":427},"end":{"line":14,"column":78,"offset":430}}},{"type":"text","value":"; let's test it:","position":{"start":{"line":14,"column":78,"offset":430},"end":{"line":14,"column":94,"offset":446}}}],"position":{"start":{"line":14,"column":1,"offset":353},"end":{"line":14,"column":94,"offset":446}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    return 1;\n}\n\nf().then(alert); // 1\n"}],"position":{"start":{"line":16,"column":1,"offset":450},"end":{"line":22,"column":4,"offset":525}}}],"position":{"start":{"line":16,"column":1,"offset":450},"end":{"line":22,"column":4,"offset":525}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"...We could explicitly return a promise, which would be the same:","position":{"start":{"line":24,"column":1,"offset":529},"end":{"line":24,"column":66,"offset":594}}}],"position":{"start":{"line":24,"column":1,"offset":529},"end":{"line":24,"column":66,"offset":594}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    return Promise.resolve(1);\n}\n\nf().then(alert); // 1\n"}],"position":{"start":{"line":26,"column":1,"offset":598},"end":{"line":32,"column":4,"offset":690}}}],"position":{"start":{"line":26,"column":1,"offset":598},"end":{"line":32,"column":4,"offset":690}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So, ","position":{"start":{"line":34,"column":1,"offset":694},"end":{"line":34,"column":5,"offset":698}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":34,"column":5,"offset":698},"end":{"line":34,"column":12,"offset":705}}},{"type":"text","value":" ensures that the function returns a promise, and wraps non-promises in it. Simple enough, right? But not only that. There's another keyword, ","position":{"start":{"line":34,"column":12,"offset":705},"end":{"line":34,"column":154,"offset":847}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":34,"column":154,"offset":847},"end":{"line":34,"column":161,"offset":854}}},{"type":"text","value":", that works only inside ","position":{"start":{"line":34,"column":161,"offset":854},"end":{"line":34,"column":186,"offset":879}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":34,"column":186,"offset":879},"end":{"line":34,"column":193,"offset":886}}},{"type":"text","value":" functions, and it's pretty cool.","position":{"start":{"line":34,"column":193,"offset":886},"end":{"line":34,"column":226,"offset":919}}}],"position":{"start":{"line":34,"column":1,"offset":694},"end":{"line":34,"column":226,"offset":919}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#await"},"children":[{"type":"text","value":"Await","position":{"start":{"line":36,"column":5,"offset":927},"end":{"line":36,"column":10,"offset":932}}}],"position":{"start":{"line":36,"column":4,"offset":926},"end":{"line":36,"column":19,"offset":941}}}],"position":{"start":{"line":36,"column":1,"offset":923},"end":{"line":36,"column":19,"offset":941}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The syntax:","position":{"start":{"line":38,"column":1,"offset":945},"end":{"line":38,"column":12,"offset":956}}}],"position":{"start":{"line":38,"column":1,"offset":945},"end":{"line":38,"column":12,"offset":956}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"// works only inside async functions\nlet value = await promise;\n"}],"position":{"start":{"line":40,"column":1,"offset":960},"end":{"line":43,"column":4,"offset":1036}}}],"position":{"start":{"line":40,"column":1,"offset":960},"end":{"line":43,"column":4,"offset":1036}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The keyword ","position":{"start":{"line":45,"column":1,"offset":1040},"end":{"line":45,"column":13,"offset":1052}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":45,"column":13,"offset":1052},"end":{"line":45,"column":20,"offset":1059}}},{"type":"text","value":" makes JavaScript wait until that promise settles and returns its result.","position":{"start":{"line":45,"column":20,"offset":1059},"end":{"line":45,"column":93,"offset":1132}}}],"position":{"start":{"line":45,"column":1,"offset":1040},"end":{"line":45,"column":93,"offset":1132}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Here's an example with a promise that resolves in 1 second:","position":{"start":{"line":47,"column":1,"offset":1136},"end":{"line":47,"column":60,"offset":1195}}}],"position":{"start":{"line":47,"column":1,"offset":1136},"end":{"line":47,"column":60,"offset":1195}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    let promise = new Promise((resolve, reject) => {\n        setTimeout(() => resolve('done!'), 1000);\n    });\n\n    let result = await promise; // wait until the promise resolves (*)\n\n    alert(result); // \"done!\"\n}\n\nf();\n"}],"position":{"start":{"line":49,"column":1,"offset":1199},"end":{"line":61,"column":4,"offset":1463}}}],"position":{"start":{"line":49,"column":1,"offset":1199},"end":{"line":61,"column":4,"offset":1463}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The function execution \"pauses\" at the line ","position":{"start":{"line":63,"column":1,"offset":1467},"end":{"line":63,"column":45,"offset":1511}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"(*)"}],"position":{"start":{"line":63,"column":45,"offset":1511},"end":{"line":63,"column":50,"offset":1516}}},{"type":"text","value":" and resumes when the promise settles, with ","position":{"start":{"line":63,"column":50,"offset":1516},"end":{"line":63,"column":94,"offset":1560}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"result"}],"position":{"start":{"line":63,"column":94,"offset":1560},"end":{"line":63,"column":102,"offset":1568}}},{"type":"text","value":" becoming its result. So the code above shows \"done!\" in one second.","position":{"start":{"line":63,"column":102,"offset":1568},"end":{"line":63,"column":170,"offset":1636}}}],"position":{"start":{"line":63,"column":1,"offset":1467},"end":{"line":63,"column":170,"offset":1636}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's emphasize: ","position":{"start":{"line":65,"column":1,"offset":1640},"end":{"line":65,"column":18,"offset":1657}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":65,"column":18,"offset":1657},"end":{"line":65,"column":25,"offset":1664}}},{"type":"text","value":" literally suspends the function execution until the promise settles, and then resumes it with the promise result. That doesn't cost any CPU resources, because the JavaScript engine can do other jobs in the meantime: execute other scripts, handle events, etc.","position":{"start":{"line":65,"column":25,"offset":1664},"end":{"line":65,"column":284,"offset":1923}}}],"position":{"start":{"line":65,"column":1,"offset":1640},"end":{"line":65,"column":284,"offset":1923}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It's just a more elegant syntax of getting the promise result than ","position":{"start":{"line":67,"column":1,"offset":1927},"end":{"line":67,"column":68,"offset":1994}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"promise.then"}],"position":{"start":{"line":67,"column":68,"offset":1994},"end":{"line":67,"column":82,"offset":2008}}},{"type":"text","value":". And, it's easier to read and write.","position":{"start":{"line":67,"column":82,"offset":2008},"end":{"line":67,"column":119,"offset":2045}}}],"position":{"start":{"line":67,"column":1,"offset":1927},"end":{"line":67,"column":119,"offset":2045}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Can't use ","position":{"start":{"line":69,"column":1,"offset":2049},"end":{"line":69,"column":11,"offset":2059}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":69,"column":11,"offset":2059},"end":{"line":69,"column":18,"offset":2066}}},{"type":"text","value":" in regular functions","position":{"start":{"line":69,"column":18,"offset":2066},"end":{"line":69,"column":39,"offset":2087}}}],"position":{"start":{"line":69,"column":1,"offset":2049},"end":{"line":69,"column":39,"offset":2087}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we try to use ","position":{"start":{"line":71,"column":1,"offset":2091},"end":{"line":71,"column":18,"offset":2108}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":71,"column":18,"offset":2108},"end":{"line":71,"column":25,"offset":2115}}},{"type":"text","value":" in a non-async function, there would be a syntax error:","position":{"start":{"line":71,"column":25,"offset":2115},"end":{"line":71,"column":81,"offset":2171}}}],"position":{"start":{"line":71,"column":1,"offset":2091},"end":{"line":71,"column":81,"offset":2171}}},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[],"position":{"start":{"line":73,"column":1,"offset":2175},"end":{"line":73,"column":4,"offset":2178}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"function f() {\n    let promise = Promise.resolve(1);\n    let result = await promise; // Syntax error\n}\n"}],"position":{"start":{"line":76,"column":1,"offset":2184},"end":{"line":83,"column":4,"offset":2305}}}],"position":{"start":{"line":76,"column":1,"offset":2184},"end":{"line":83,"column":4,"offset":2305}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We may get this error if we forget to put ","position":{"start":{"line":85,"column":1,"offset":2309},"end":{"line":85,"column":43,"offset":2351}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":85,"column":43,"offset":2351},"end":{"line":85,"column":50,"offset":2358}}},{"type":"text","value":" before a function. As stated earlier, ","position":{"start":{"line":85,"column":50,"offset":2358},"end":{"line":85,"column":89,"offset":2397}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":85,"column":89,"offset":2397},"end":{"line":85,"column":96,"offset":2404}}},{"type":"text","value":" only works inside an ","position":{"start":{"line":85,"column":96,"offset":2404},"end":{"line":85,"column":118,"offset":2426}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":85,"column":118,"offset":2426},"end":{"line":85,"column":125,"offset":2433}}},{"type":"text","value":" function.","position":{"start":{"line":85,"column":125,"offset":2433},"end":{"line":85,"column":135,"offset":2443}}}],"position":{"start":{"line":85,"column":1,"offset":2309},"end":{"line":85,"column":135,"offset":2443}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's take the ","position":{"start":{"line":87,"column":1,"offset":2447},"end":{"line":87,"column":16,"offset":2462}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"showAvatar()"}],"position":{"start":{"line":87,"column":16,"offset":2462},"end":{"line":87,"column":30,"offset":2476}}},{"type":"text","value":" example from the chapter ","position":{"start":{"line":87,"column":30,"offset":2476},"end":{"line":87,"column":56,"offset":2502}}},{"type":"element","tagName":"a","properties":{"href":"promise-chaining"},"children":[{"type":"text","value":"Promises chaining","position":{"start":{"line":87,"column":57,"offset":2503},"end":{"line":87,"column":74,"offset":2520}}}],"position":{"start":{"line":87,"column":56,"offset":2502},"end":{"line":87,"column":93,"offset":2539}}},{"type":"text","value":" and rewrite it using ","position":{"start":{"line":87,"column":93,"offset":2539},"end":{"line":87,"column":115,"offset":2561}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async/await"}],"position":{"start":{"line":87,"column":115,"offset":2561},"end":{"line":87,"column":128,"offset":2574}}},{"type":"text","value":":","position":{"start":{"line":87,"column":128,"offset":2574},"end":{"line":87,"column":129,"offset":2575}}}],"position":{"start":{"line":87,"column":1,"offset":2447},"end":{"line":87,"column":129,"offset":2575}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"We'll need to replace ","position":{"start":{"line":89,"column":5,"offset":2583},"end":{"line":89,"column":27,"offset":2605}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".then"}],"position":{"start":{"line":89,"column":27,"offset":2605},"end":{"line":89,"column":34,"offset":2612}}},{"type":"text","value":" calls with ","position":{"start":{"line":89,"column":34,"offset":2612},"end":{"line":89,"column":46,"offset":2624}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":89,"column":46,"offset":2624},"end":{"line":89,"column":53,"offset":2631}}},{"type":"text","value":".","position":{"start":{"line":89,"column":53,"offset":2631},"end":{"line":89,"column":54,"offset":2632}}}],"position":{"start":{"line":89,"column":1,"offset":2579},"end":{"line":89,"column":54,"offset":2632}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Also we should make the function ","position":{"start":{"line":90,"column":5,"offset":2638},"end":{"line":90,"column":38,"offset":2671}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":90,"column":38,"offset":2671},"end":{"line":90,"column":45,"offset":2678}}},{"type":"text","value":" for them to work.","position":{"start":{"line":90,"column":45,"offset":2678},"end":{"line":90,"column":63,"offset":2696}}}],"position":{"start":{"line":90,"column":1,"offset":2634},"end":{"line":90,"column":63,"offset":2696}}},{"type":"text","value":"\n"}],"position":{"start":{"line":89,"column":1,"offset":2579},"end":{"line":90,"column":63,"offset":2696}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function showAvatar() {\n    // read our JSON\n    let response = await fetch('/article/promise-chaining/user.json');\n    let user = await response.json();\n\n    // read github user\n    let githubResponse = await fetch(`https://api.github.com/users/${user.name}`);\n    let githubUser = await githubResponse.json();\n\n    // show the avatar\n    let img = document.createElement('img');\n    img.src = githubUser.avatar_url;\n    img.className = 'promise-avatar-example';\n    document.body.append(img);\n\n    // wait 3 seconds\n    await new Promise((resolve, reject) => setTimeout(resolve, 3000));\n\n    img.remove();\n\n    return githubUser;\n}\n\nshowAvatar();\n"}],"position":{"start":{"line":92,"column":1,"offset":2700},"end":{"line":117,"column":4,"offset":3389}}}],"position":{"start":{"line":92,"column":1,"offset":2700},"end":{"line":117,"column":4,"offset":3389}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pretty clean and easy to read, right? Much better than before.","position":{"start":{"line":119,"column":1,"offset":3393},"end":{"line":119,"column":63,"offset":3455}}}],"position":{"start":{"line":119,"column":1,"offset":3393},"end":{"line":119,"column":63,"offset":3455}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"await` won't work in the top-level code\n\nPeople who are just starting to use `await` tend to forget the fact that we can't use `await` in top-level code. For example, this will not work:\n\n```js\n// syntax error in top-level code\nlet response = await fetch('/article/promise-chaining/user.json');\nlet user = await response.json();\n"}],"position":{"start":{"line":121,"column":1,"offset":3459},"end":{"line":130,"column":4,"offset":3806}}}],"position":{"start":{"line":121,"column":1,"offset":3459},"end":{"line":130,"column":4,"offset":3806}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But we can wrap it into an anonymous async function, like this:","position":{"start":{"line":132,"column":1,"offset":3810},"end":{"line":132,"column":64,"offset":3873}}}],"position":{"start":{"line":132,"column":1,"offset":3810},"end":{"line":132,"column":64,"offset":3873}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"(async () => {\n  let response = await fetch('/article/promise-chaining/user.json');\n  let user = await response.json();\n  ...\n})();\n"}],"position":{"start":{"line":134,"column":1,"offset":3877},"end":{"line":140,"column":4,"offset":4024}}}],"position":{"start":{"line":134,"column":1,"offset":3877},"end":{"line":140,"column":4,"offset":4024}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"P.S. New feature: starting from V8 engine version 8.9+, top-level await works in ","position":{"start":{"line":142,"column":1,"offset":4028},"end":{"line":142,"column":82,"offset":4109}}},{"type":"element","tagName":"a","properties":{"href":"modules"},"children":[{"type":"text","value":"modules","position":{"start":{"line":142,"column":83,"offset":4110},"end":{"line":142,"column":90,"offset":4117}}}],"position":{"start":{"line":142,"column":82,"offset":4109},"end":{"line":142,"column":100,"offset":4127}}},{"type":"text","value":".","position":{"start":{"line":142,"column":100,"offset":4127},"end":{"line":142,"column":101,"offset":4128}}}],"position":{"start":{"line":142,"column":1,"offset":4028},"end":{"line":142,"column":101,"offset":4128}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"await` accepts \"thenables\"\n\nLike `promise.then`, `await` allows us to use thenable objects (those with a callable `then` method). The idea is that a third-party object may not be a promise, but promise-compatible: if it supports `.then`, that's enough to use it with `await`.\n\nHere's a demo `Thenable` class; the `await` below accepts its instances:\n\n```js\nclass Thenable {\n  constructor(num) {\n    this.num = num;\n  }\n  then(resolve, reject) {\n    alert(resolve);\n    // resolve with this.num*2 after 1000ms\n    setTimeout(() => resolve(this.num * 2), 1000); // (*)\n  }\n}\n\nasync function f() {\n  // waits for 1 second, then result becomes 2\n  let result = await new Thenable(1);\n  alert(result);\n}\n\nf();\n"}],"position":{"start":{"line":144,"column":1,"offset":4132},"end":{"line":170,"column":4,"offset":4872}}}],"position":{"start":{"line":144,"column":1,"offset":4132},"end":{"line":170,"column":4,"offset":4872}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If ","position":{"start":{"line":172,"column":1,"offset":4876},"end":{"line":172,"column":4,"offset":4879}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":172,"column":4,"offset":4879},"end":{"line":172,"column":11,"offset":4886}}},{"type":"text","value":" gets a non-promise object with ","position":{"start":{"line":172,"column":11,"offset":4886},"end":{"line":172,"column":43,"offset":4918}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".then"}],"position":{"start":{"line":172,"column":43,"offset":4918},"end":{"line":172,"column":50,"offset":4925}}},{"type":"text","value":", it calls that method providing the built-in functions ","position":{"start":{"line":172,"column":50,"offset":4925},"end":{"line":172,"column":106,"offset":4981}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"resolve"}],"position":{"start":{"line":172,"column":106,"offset":4981},"end":{"line":172,"column":115,"offset":4990}}},{"type":"text","value":" and ","position":{"start":{"line":172,"column":115,"offset":4990},"end":{"line":172,"column":120,"offset":4995}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"reject"}],"position":{"start":{"line":172,"column":120,"offset":4995},"end":{"line":172,"column":128,"offset":5003}}},{"type":"text","value":" as arguments (just as it does for a regular ","position":{"start":{"line":172,"column":128,"offset":5003},"end":{"line":172,"column":173,"offset":5048}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Promise"}],"position":{"start":{"line":172,"column":173,"offset":5048},"end":{"line":172,"column":182,"offset":5057}}},{"type":"text","value":" executor). Then ","position":{"start":{"line":172,"column":182,"offset":5057},"end":{"line":172,"column":199,"offset":5074}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":172,"column":199,"offset":5074},"end":{"line":172,"column":206,"offset":5081}}},{"type":"text","value":" waits until one of them is called (in the example above it happens in the line ","position":{"start":{"line":172,"column":206,"offset":5081},"end":{"line":172,"column":286,"offset":5161}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"(*)"}],"position":{"start":{"line":172,"column":286,"offset":5161},"end":{"line":172,"column":291,"offset":5166}}},{"type":"text","value":") and then proceeds with the result.","position":{"start":{"line":172,"column":291,"offset":5166},"end":{"line":172,"column":327,"offset":5202}}}],"position":{"start":{"line":172,"column":1,"offset":4876},"end":{"line":172,"column":327,"offset":5202}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Async class methods","position":{"start":{"line":174,"column":1,"offset":5206},"end":{"line":174,"column":20,"offset":5225}}}],"position":{"start":{"line":174,"column":1,"offset":5206},"end":{"line":174,"column":20,"offset":5225}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To declare an async class method, just prepend it with ","position":{"start":{"line":176,"column":1,"offset":5229},"end":{"line":176,"column":56,"offset":5284}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":176,"column":56,"offset":5284},"end":{"line":176,"column":63,"offset":5291}}},{"type":"text","value":":","position":{"start":{"line":176,"column":63,"offset":5291},"end":{"line":176,"column":64,"offset":5292}}}],"position":{"start":{"line":176,"column":1,"offset":5229},"end":{"line":176,"column":64,"offset":5292}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"class Waiter {\n    async wait() {\n        return await Promise.resolve(1);\n    }\n}\n\nnew Waiter().wait().then(alert); // 1 (this is the same as (result => alert(result)))\n"}],"position":{"start":{"line":178,"column":1,"offset":5296},"end":{"line":186,"column":4,"offset":5483}}}],"position":{"start":{"line":178,"column":1,"offset":5296},"end":{"line":186,"column":4,"offset":5483}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The meaning is the same: it ensures that the returned value is a promise and enables ","position":{"start":{"line":188,"column":1,"offset":5487},"end":{"line":188,"column":86,"offset":5572}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":188,"column":86,"offset":5572},"end":{"line":188,"column":93,"offset":5579}}},{"type":"text","value":".","position":{"start":{"line":188,"column":93,"offset":5579},"end":{"line":188,"column":94,"offset":5580}}}],"position":{"start":{"line":188,"column":1,"offset":5487},"end":{"line":188,"column":94,"offset":5580}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"[Error handling]","position":{"start":{"line":190,"column":5,"offset":5588},"end":{"line":190,"column":19,"offset":5602}}}],"position":{"start":{"line":190,"column":1,"offset":5584},"end":{"line":190,"column":20,"offset":5603}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If a promise resolves normally, then ","position":{"start":{"line":192,"column":1,"offset":5607},"end":{"line":192,"column":38,"offset":5644}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await promise"}],"position":{"start":{"line":192,"column":38,"offset":5644},"end":{"line":192,"column":53,"offset":5659}}},{"type":"text","value":" returns the result. But in the case of a rejection, it throws the error, just as if there were a ","position":{"start":{"line":192,"column":53,"offset":5659},"end":{"line":192,"column":151,"offset":5757}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"throw"}],"position":{"start":{"line":192,"column":151,"offset":5757},"end":{"line":192,"column":158,"offset":5764}}},{"type":"text","value":" statement at that line.","position":{"start":{"line":192,"column":158,"offset":5764},"end":{"line":192,"column":182,"offset":5788}}}],"position":{"start":{"line":192,"column":1,"offset":5607},"end":{"line":192,"column":182,"offset":5788}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This code:","position":{"start":{"line":194,"column":1,"offset":5792},"end":{"line":194,"column":11,"offset":5802}}}],"position":{"start":{"line":194,"column":1,"offset":5792},"end":{"line":194,"column":11,"offset":5802}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    await Promise.reject(new Error('Whoops!'));\n}\n"}],"position":{"start":{"line":196,"column":1,"offset":5806},"end":{"line":200,"column":4,"offset":5890}}}],"position":{"start":{"line":196,"column":1,"offset":5806},"end":{"line":200,"column":4,"offset":5890}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"...is the same as this:","position":{"start":{"line":202,"column":1,"offset":5894},"end":{"line":202,"column":24,"offset":5917}}}],"position":{"start":{"line":202,"column":1,"offset":5894},"end":{"line":202,"column":24,"offset":5917}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    throw new Error('Whoops!');\n}\n"}],"position":{"start":{"line":204,"column":1,"offset":5921},"end":{"line":208,"column":4,"offset":5989}}}],"position":{"start":{"line":204,"column":1,"offset":5921},"end":{"line":208,"column":4,"offset":5989}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In real situations, the promise may take some time before it rejects. In that case there will be a delay before ","position":{"start":{"line":210,"column":1,"offset":5993},"end":{"line":210,"column":113,"offset":6105}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":210,"column":113,"offset":6105},"end":{"line":210,"column":120,"offset":6112}}},{"type":"text","value":" throws an error.","position":{"start":{"line":210,"column":120,"offset":6112},"end":{"line":210,"column":137,"offset":6129}}}],"position":{"start":{"line":210,"column":1,"offset":5993},"end":{"line":210,"column":137,"offset":6129}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can catch that error using ","position":{"start":{"line":212,"column":1,"offset":6133},"end":{"line":212,"column":31,"offset":6163}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"try..catch"}],"position":{"start":{"line":212,"column":31,"offset":6163},"end":{"line":212,"column":43,"offset":6175}}},{"type":"text","value":", the same way as a regular ","position":{"start":{"line":212,"column":43,"offset":6175},"end":{"line":212,"column":71,"offset":6203}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"throw"}],"position":{"start":{"line":212,"column":71,"offset":6203},"end":{"line":212,"column":78,"offset":6210}}},{"type":"text","value":":","position":{"start":{"line":212,"column":78,"offset":6210},"end":{"line":212,"column":79,"offset":6211}}}],"position":{"start":{"line":212,"column":1,"offset":6133},"end":{"line":212,"column":79,"offset":6211}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    try {\n        let response = await fetch('http://no-such-url');\n    } catch (err) {\n        alert(err); // TypeError: failed to fetch\n    }\n}\n\nf();\n"}],"position":{"start":{"line":214,"column":1,"offset":6215},"end":{"line":224,"column":4,"offset":6407}}}],"position":{"start":{"line":214,"column":1,"offset":6215},"end":{"line":224,"column":4,"offset":6407}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In the case of an error, the control jumps to the ","position":{"start":{"line":226,"column":1,"offset":6411},"end":{"line":226,"column":51,"offset":6461}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"catch"}],"position":{"start":{"line":226,"column":51,"offset":6461},"end":{"line":226,"column":58,"offset":6468}}},{"type":"text","value":" block. We can also wrap multiple lines:","position":{"start":{"line":226,"column":58,"offset":6468},"end":{"line":226,"column":98,"offset":6508}}}],"position":{"start":{"line":226,"column":1,"offset":6411},"end":{"line":226,"column":98,"offset":6508}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    try {\n        let response = await fetch('/no-user-here');\n        let user = await response.json();\n    } catch (err) {\n        // catches errors both in fetch and response.json\n        alert(err);\n    }\n}\n\nf();\n"}],"position":{"start":{"line":228,"column":1,"offset":6512},"end":{"line":240,"column":4,"offset":6771}}}],"position":{"start":{"line":228,"column":1,"offset":6512},"end":{"line":240,"column":4,"offset":6771}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we don't have ","position":{"start":{"line":242,"column":1,"offset":6775},"end":{"line":242,"column":18,"offset":6792}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"try..catch"}],"position":{"start":{"line":242,"column":18,"offset":6792},"end":{"line":242,"column":30,"offset":6804}}},{"type":"text","value":", then the promise generated by the call of the async function ","position":{"start":{"line":242,"column":30,"offset":6804},"end":{"line":242,"column":93,"offset":6867}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"f()"}],"position":{"start":{"line":242,"column":93,"offset":6867},"end":{"line":242,"column":98,"offset":6872}}},{"type":"text","value":" becomes rejected. We can append ","position":{"start":{"line":242,"column":98,"offset":6872},"end":{"line":242,"column":131,"offset":6905}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".catch"}],"position":{"start":{"line":242,"column":131,"offset":6905},"end":{"line":242,"column":139,"offset":6913}}},{"type":"text","value":" to handle it:","position":{"start":{"line":242,"column":139,"offset":6913},"end":{"line":242,"column":153,"offset":6927}}}],"position":{"start":{"line":242,"column":1,"offset":6775},"end":{"line":242,"column":153,"offset":6927}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async function f() {\n    let response = await fetch('http://no-such-url');\n}\n\n// f() becomes a rejected promise\nf().catch(alert); // TypeError: failed to fetch // (*)\n"}],"position":{"start":{"line":244,"column":1,"offset":6931},"end":{"line":251,"column":4,"offset":7114}}}],"position":{"start":{"line":244,"column":1,"offset":6931},"end":{"line":251,"column":4,"offset":7114}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we forget to add ","position":{"start":{"line":253,"column":1,"offset":7118},"end":{"line":253,"column":21,"offset":7138}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".catch"}],"position":{"start":{"line":253,"column":21,"offset":7138},"end":{"line":253,"column":29,"offset":7146}}},{"type":"text","value":" there, then we get an unhandled promise error (viewable in the console). We can catch such errors using a global ","position":{"start":{"line":253,"column":29,"offset":7146},"end":{"line":253,"column":143,"offset":7260}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"unhandledrejection"}],"position":{"start":{"line":253,"column":143,"offset":7260},"end":{"line":253,"column":163,"offset":7280}}},{"type":"text","value":" event handler as described in the chapter ","position":{"start":{"line":253,"column":163,"offset":7280},"end":{"line":253,"column":206,"offset":7323}}},{"type":"element","tagName":"a","properties":{"href":"promise-error-handling"},"children":[{"type":"text","value":"Error handling with promises","position":{"start":{"line":253,"column":207,"offset":7324},"end":{"line":253,"column":235,"offset":7352}}}],"position":{"start":{"line":253,"column":206,"offset":7323},"end":{"line":253,"column":260,"offset":7377}}},{"type":"text","value":".","position":{"start":{"line":253,"column":260,"offset":7377},"end":{"line":253,"column":261,"offset":7378}}}],"position":{"start":{"line":253,"column":1,"offset":7118},"end":{"line":253,"column":261,"offset":7378}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async/await` and `promise.then/catch\n"}],"position":{"start":{"line":255,"column":1,"offset":7382},"end":{"line":257,"column":4,"offset":7430}}}],"position":{"start":{"line":255,"column":1,"offset":7382},"end":{"line":257,"column":4,"offset":7430}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When we use ","position":{"start":{"line":259,"column":1,"offset":7434},"end":{"line":259,"column":13,"offset":7446}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async/await"}],"position":{"start":{"line":259,"column":13,"offset":7446},"end":{"line":259,"column":26,"offset":7459}}},{"type":"text","value":", we rarely need ","position":{"start":{"line":259,"column":26,"offset":7459},"end":{"line":259,"column":43,"offset":7476}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".then"}],"position":{"start":{"line":259,"column":43,"offset":7476},"end":{"line":259,"column":50,"offset":7483}}},{"type":"text","value":", because ","position":{"start":{"line":259,"column":50,"offset":7483},"end":{"line":259,"column":60,"offset":7493}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":259,"column":60,"offset":7493},"end":{"line":259,"column":67,"offset":7500}}},{"type":"text","value":" handles the waiting for us. And we can use a regular ","position":{"start":{"line":259,"column":67,"offset":7500},"end":{"line":259,"column":121,"offset":7554}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"try..catch"}],"position":{"start":{"line":259,"column":121,"offset":7554},"end":{"line":259,"column":133,"offset":7566}}},{"type":"text","value":" instead of ","position":{"start":{"line":259,"column":133,"offset":7566},"end":{"line":259,"column":145,"offset":7578}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".catch"}],"position":{"start":{"line":259,"column":145,"offset":7578},"end":{"line":259,"column":153,"offset":7586}}},{"type":"text","value":". That's usually (but not always) more convenient.","position":{"start":{"line":259,"column":153,"offset":7586},"end":{"line":259,"column":203,"offset":7636}}}],"position":{"start":{"line":259,"column":1,"offset":7434},"end":{"line":259,"column":203,"offset":7636}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But at the top level of the code, when we're outside any ","position":{"start":{"line":261,"column":1,"offset":7640},"end":{"line":261,"column":58,"offset":7697}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":261,"column":58,"offset":7697},"end":{"line":261,"column":65,"offset":7704}}},{"type":"text","value":" function, we're syntactically unable to use ","position":{"start":{"line":261,"column":65,"offset":7704},"end":{"line":261,"column":110,"offset":7749}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":261,"column":110,"offset":7749},"end":{"line":261,"column":117,"offset":7756}}},{"type":"text","value":", so it's a normal practice to add ","position":{"start":{"line":261,"column":117,"offset":7756},"end":{"line":261,"column":152,"offset":7791}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".then/catch"}],"position":{"start":{"line":261,"column":152,"offset":7791},"end":{"line":261,"column":165,"offset":7804}}},{"type":"text","value":" to handle the final result or falling-through error, like in the line ","position":{"start":{"line":261,"column":165,"offset":7804},"end":{"line":261,"column":236,"offset":7875}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"(*)"}],"position":{"start":{"line":261,"column":236,"offset":7875},"end":{"line":261,"column":241,"offset":7880}}},{"type":"text","value":" of the example above.","position":{"start":{"line":261,"column":241,"offset":7880},"end":{"line":261,"column":263,"offset":7902}}}],"position":{"start":{"line":261,"column":1,"offset":7640},"end":{"line":261,"column":263,"offset":7902}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"async/await` works well with `Promise.all\n"}],"position":{"start":{"line":263,"column":1,"offset":7906},"end":{"line":265,"column":4,"offset":7959}}}],"position":{"start":{"line":263,"column":1,"offset":7906},"end":{"line":265,"column":4,"offset":7959}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When we need to wait for multiple promises, we can wrap them in ","position":{"start":{"line":267,"column":1,"offset":7963},"end":{"line":267,"column":65,"offset":8027}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Promise.all"}],"position":{"start":{"line":267,"column":65,"offset":8027},"end":{"line":267,"column":78,"offset":8040}}},{"type":"text","value":" and then ","position":{"start":{"line":267,"column":78,"offset":8040},"end":{"line":267,"column":88,"offset":8050}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":267,"column":88,"offset":8050},"end":{"line":267,"column":95,"offset":8057}}},{"type":"text","value":":","position":{"start":{"line":267,"column":95,"offset":8057},"end":{"line":267,"column":96,"offset":8058}}}],"position":{"start":{"line":267,"column":1,"offset":7963},"end":{"line":267,"column":96,"offset":8058}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"// wait for the array of results\nlet results = await Promise.all([\n  fetch(url1),\n  fetch(url2),\n  ...\n]);\n"}],"position":{"start":{"line":269,"column":1,"offset":8062},"end":{"line":276,"column":4,"offset":8185}}}],"position":{"start":{"line":269,"column":1,"offset":8062},"end":{"line":276,"column":4,"offset":8185}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In the case of an error, it propagates as usual, from the failed promise to ","position":{"start":{"line":278,"column":1,"offset":8189},"end":{"line":278,"column":77,"offset":8265}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Promise.all"}],"position":{"start":{"line":278,"column":77,"offset":8265},"end":{"line":278,"column":90,"offset":8278}}},{"type":"text","value":", and then becomes an exception that we can catch using ","position":{"start":{"line":278,"column":90,"offset":8278},"end":{"line":278,"column":146,"offset":8334}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"try..catch"}],"position":{"start":{"line":278,"column":146,"offset":8334},"end":{"line":278,"column":158,"offset":8346}}},{"type":"text","value":" around the call.","position":{"start":{"line":278,"column":158,"offset":8346},"end":{"line":278,"column":175,"offset":8363}}}],"position":{"start":{"line":278,"column":1,"offset":8189},"end":{"line":278,"column":175,"offset":8363}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#summary"},"children":[{"type":"text","value":"Summary","position":{"start":{"line":280,"column":5,"offset":8371},"end":{"line":280,"column":12,"offset":8378}}}],"position":{"start":{"line":280,"column":4,"offset":8370},"end":{"line":280,"column":23,"offset":8389}}}],"position":{"start":{"line":280,"column":1,"offset":8367},"end":{"line":280,"column":23,"offset":8389}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The ","position":{"start":{"line":282,"column":1,"offset":8393},"end":{"line":282,"column":5,"offset":8397}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":282,"column":5,"offset":8397},"end":{"line":282,"column":12,"offset":8404}}},{"type":"text","value":" keyword before a function has two effects:","position":{"start":{"line":282,"column":12,"offset":8404},"end":{"line":282,"column":55,"offset":8447}}}],"position":{"start":{"line":282,"column":1,"offset":8393},"end":{"line":282,"column":55,"offset":8447}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Makes it always return a promise.","position":{"start":{"line":284,"column":5,"offset":8455},"end":{"line":284,"column":38,"offset":8488}}}],"position":{"start":{"line":284,"column":1,"offset":8451},"end":{"line":284,"column":38,"offset":8488}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Allows ","position":{"start":{"line":285,"column":5,"offset":8494},"end":{"line":285,"column":12,"offset":8501}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":285,"column":12,"offset":8501},"end":{"line":285,"column":19,"offset":8508}}},{"type":"text","value":" to be used in it.","position":{"start":{"line":285,"column":19,"offset":8508},"end":{"line":285,"column":37,"offset":8526}}}],"position":{"start":{"line":285,"column":1,"offset":8490},"end":{"line":285,"column":37,"offset":8526}}},{"type":"text","value":"\n"}],"position":{"start":{"line":284,"column":1,"offset":8451},"end":{"line":285,"column":37,"offset":8526}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The ","position":{"start":{"line":287,"column":1,"offset":8530},"end":{"line":287,"column":5,"offset":8534}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":287,"column":5,"offset":8534},"end":{"line":287,"column":12,"offset":8541}}},{"type":"text","value":" keyword before a promise makes JavaScript wait until that promise settles, and then:","position":{"start":{"line":287,"column":12,"offset":8541},"end":{"line":287,"column":97,"offset":8626}}}],"position":{"start":{"line":287,"column":1,"offset":8530},"end":{"line":287,"column":97,"offset":8626}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"If it's an error, the exception is generated --- same as if ","position":{"start":{"line":289,"column":5,"offset":8634},"end":{"line":289,"column":65,"offset":8694}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"throw error"}],"position":{"start":{"line":289,"column":65,"offset":8694},"end":{"line":289,"column":78,"offset":8707}}},{"type":"text","value":" were called at that very place.","position":{"start":{"line":289,"column":78,"offset":8707},"end":{"line":289,"column":110,"offset":8739}}}],"position":{"start":{"line":289,"column":1,"offset":8630},"end":{"line":289,"column":110,"offset":8739}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Otherwise, it returns the result.","position":{"start":{"line":290,"column":5,"offset":8745},"end":{"line":290,"column":38,"offset":8778}}}],"position":{"start":{"line":290,"column":1,"offset":8741},"end":{"line":290,"column":38,"offset":8778}}},{"type":"text","value":"\n"}],"position":{"start":{"line":289,"column":1,"offset":8630},"end":{"line":290,"column":38,"offset":8778}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Together they provide a great framework to write asynchronous code that is easy to both read and write.","position":{"start":{"line":292,"column":1,"offset":8782},"end":{"line":292,"column":104,"offset":8885}}}],"position":{"start":{"line":292,"column":1,"offset":8782},"end":{"line":292,"column":104,"offset":8885}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With ","position":{"start":{"line":294,"column":1,"offset":8889},"end":{"line":294,"column":6,"offset":8894}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async/await"}],"position":{"start":{"line":294,"column":6,"offset":8894},"end":{"line":294,"column":19,"offset":8907}}},{"type":"text","value":" we rarely need to write ","position":{"start":{"line":294,"column":19,"offset":8907},"end":{"line":294,"column":44,"offset":8932}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"promise.then/catch"}],"position":{"start":{"line":294,"column":44,"offset":8932},"end":{"line":294,"column":64,"offset":8952}}},{"type":"text","value":", but we still shouldn't forget that they are based on promises, because sometimes (e.g. in the outermost scope) we have to use these methods. Also ","position":{"start":{"line":294,"column":64,"offset":8952},"end":{"line":294,"column":212,"offset":9100}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Promise.all"}],"position":{"start":{"line":294,"column":212,"offset":9100},"end":{"line":294,"column":225,"offset":9113}}},{"type":"text","value":" is nice when we are waiting for many tasks simultaneously.","position":{"start":{"line":294,"column":225,"offset":9113},"end":{"line":294,"column":284,"offset":9172}}}],"position":{"start":{"line":294,"column":1,"offset":8889},"end":{"line":294,"column":284,"offset":9172}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Cleaning up your asynchronous code with ","position":{"start":{"line":296,"column":4,"offset":9179},"end":{"line":296,"column":44,"offset":9219}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":296,"column":44,"offset":9219},"end":{"line":296,"column":51,"offset":9226}}}],"position":{"start":{"line":296,"column":1,"offset":9176},"end":{"line":296,"column":51,"offset":9226}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"REPLs have traditionally had a difficult time allowing you to interact with asynchronous code since they encourage a coding style where you evaluate expressions and use those results in the next field. But if you are using promises or callbacks, this breaks down because these results exist only in the callback, not the next line:","position":{"start":{"line":298,"column":1,"offset":9230},"end":{"line":298,"column":332,"offset":9561}}}],"position":{"start":{"line":298,"column":1,"offset":9230},"end":{"line":298,"column":332,"offset":9561}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In RunKit, you can use top-level ","position":{"start":{"line":300,"column":1,"offset":9565},"end":{"line":300,"column":34,"offset":9598}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":300,"column":34,"offset":9598},"end":{"line":300,"column":41,"offset":9605}}},{"type":"text","value":" to get the same behavior of synchronous code.","position":{"start":{"line":300,"column":41,"offset":9605},"end":{"line":300,"column":87,"offset":9651}}}],"position":{"start":{"line":300,"column":1,"offset":9565},"end":{"line":300,"column":87,"offset":9651}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we can treat this code as synchronous, despite the fact that the code is still executing asynchronously.","position":{"start":{"line":302,"column":1,"offset":9655},"end":{"line":302,"column":109,"offset":9763}}}],"position":{"start":{"line":302,"column":1,"offset":9655},"end":{"line":302,"column":109,"offset":9763}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's look how. It helps to have a more complex example, where we need to do a few asynchronous operations in sequence. You can see how ","position":{"start":{"line":304,"column":1,"offset":9767},"end":{"line":304,"column":137,"offset":9903}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":304,"column":137,"offset":9903},"end":{"line":304,"column":144,"offset":9910}}},{"type":"text","value":", promises and callbacks achieve the same results, but the ","position":{"start":{"line":304,"column":144,"offset":9910},"end":{"line":304,"column":203,"offset":9969}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":304,"column":203,"offset":9969},"end":{"line":304,"column":210,"offset":9976}}},{"type":"text","value":" style works better in a REPL:","position":{"start":{"line":304,"column":210,"offset":9976},"end":{"line":304,"column":240,"offset":10006}}}],"position":{"start":{"line":304,"column":1,"offset":9767},"end":{"line":304,"column":240,"offset":10006}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"await","position":{"start":{"line":306,"column":3,"offset":10012},"end":{"line":306,"column":8,"offset":10017}}}],"position":{"start":{"line":306,"column":1,"offset":10010},"end":{"line":306,"column":8,"offset":10017}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"promises","position":{"start":{"line":307,"column":3,"offset":10021},"end":{"line":307,"column":11,"offset":10029}}}],"position":{"start":{"line":307,"column":1,"offset":10019},"end":{"line":307,"column":11,"offset":10029}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"callbacks","position":{"start":{"line":308,"column":3,"offset":10033},"end":{"line":308,"column":12,"offset":10042}}}],"position":{"start":{"line":308,"column":1,"offset":10031},"end":{"line":308,"column":12,"offset":10042}}},{"type":"text","value":"\n"}],"position":{"start":{"line":306,"column":1,"offset":10010},"end":{"line":308,"column":12,"offset":10042}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Here, we use ","position":{"start":{"line":310,"column":1,"offset":10046},"end":{"line":310,"column":14,"offset":10059}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":310,"column":14,"offset":10059},"end":{"line":310,"column":21,"offset":10066}}},{"type":"text","value":" on lines 4 and 8, and the results from each request remain in scope.","position":{"start":{"line":310,"column":21,"offset":10066},"end":{"line":310,"column":90,"offset":10135}}}],"position":{"start":{"line":310,"column":1,"offset":10046},"end":{"line":310,"column":90,"offset":10135}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Remember, ","position":{"start":{"line":312,"column":1,"offset":10139},"end":{"line":312,"column":11,"offset":10149}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":312,"column":11,"offset":10149},"end":{"line":312,"column":18,"offset":10156}}},{"type":"text","value":" expects a ","position":{"start":{"line":312,"column":18,"offset":10156},"end":{"line":312,"column":29,"offset":10167}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"promise"}],"position":{"start":{"line":312,"column":29,"offset":10167},"end":{"line":312,"column":38,"offset":10176}}},{"type":"text","value":" so you can either write your own or use one of the many libraries that natively supports promises, and npm is full of packages that add promise support to existing libraries. Here are a few of our favorites:","position":{"start":{"line":312,"column":38,"offset":10176},"end":{"line":312,"column":246,"offset":10384}}}],"position":{"start":{"line":312,"column":1,"offset":10139},"end":{"line":312,"column":246,"offset":10384}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://npm.runkit.com/fs-promise"},"children":[{"type":"text","value":"fs-promise","position":{"start":{"line":314,"column":4,"offset":10391},"end":{"line":314,"column":14,"offset":10401}}}],"position":{"start":{"line":314,"column":3,"offset":10390},"end":{"line":314,"column":50,"offset":10437}}},{"type":"text","value":" - promise based filesystem api","position":{"start":{"line":314,"column":50,"offset":10437},"end":{"line":314,"column":81,"offset":10468}}}],"position":{"start":{"line":314,"column":1,"offset":10388},"end":{"line":314,"column":81,"offset":10468}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://npm.runkit.com/request-promise"},"children":[{"type":"text","value":"request-promise","position":{"start":{"line":315,"column":4,"offset":10473},"end":{"line":315,"column":19,"offset":10488}}}],"position":{"start":{"line":315,"column":3,"offset":10472},"end":{"line":315,"column":60,"offset":10529}}},{"type":"text","value":" - a wrapper around \"request\" for http stuff","position":{"start":{"line":315,"column":60,"offset":10529},"end":{"line":315,"column":104,"offset":10573}}}],"position":{"start":{"line":315,"column":1,"offset":10470},"end":{"line":315,"column":104,"offset":10573}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://npm.runkit.com/glob-promise"},"children":[{"type":"text","value":"glob-promise","position":{"start":{"line":316,"column":4,"offset":10578},"end":{"line":316,"column":16,"offset":10590}}}],"position":{"start":{"line":316,"column":3,"offset":10577},"end":{"line":316,"column":54,"offset":10628}}},{"type":"text","value":" - glob style filesystem queries","position":{"start":{"line":316,"column":54,"offset":10628},"end":{"line":316,"column":86,"offset":10660}}}],"position":{"start":{"line":316,"column":1,"offset":10575},"end":{"line":316,"column":86,"offset":10660}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://npm.runkit.com/bluebird"},"children":[{"type":"text","value":"bluebird","position":{"start":{"line":317,"column":4,"offset":10665},"end":{"line":317,"column":12,"offset":10673}}}],"position":{"start":{"line":317,"column":3,"offset":10664},"end":{"line":317,"column":46,"offset":10707}}},{"type":"text","value":" - general promise library with lots of utilities","position":{"start":{"line":317,"column":46,"offset":10707},"end":{"line":317,"column":95,"offset":10756}}}],"position":{"start":{"line":317,"column":1,"offset":10662},"end":{"line":317,"column":95,"offset":10756}}},{"type":"text","value":"\n"}],"position":{"start":{"line":314,"column":1,"offset":10388},"end":{"line":317,"column":95,"offset":10756}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Further Reading","position":{"start":{"line":319,"column":5,"offset":10764},"end":{"line":319,"column":20,"offset":10779}}}],"position":{"start":{"line":319,"column":1,"offset":10760},"end":{"line":319,"column":20,"offset":10779}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://rossboucher.com/await"},"children":[{"type":"text","value":"ES7 Async/Await presented at Brookyln.js","position":{"start":{"line":321,"column":4,"offset":10786},"end":{"line":321,"column":44,"offset":10826}}}],"position":{"start":{"line":321,"column":3,"offset":10785},"end":{"line":321,"column":75,"offset":10857}}}],"position":{"start":{"line":321,"column":1,"offset":10783},"end":{"line":321,"column":75,"offset":10857}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://babeljs.io/"},"children":[{"type":"text","value":"Babel.js","position":{"start":{"line":322,"column":4,"offset":10862},"end":{"line":322,"column":12,"offset":10870}}}],"position":{"start":{"line":322,"column":3,"offset":10861},"end":{"line":322,"column":34,"offset":10892}}}],"position":{"start":{"line":322,"column":1,"offset":10859},"end":{"line":322,"column":34,"offset":10892}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/lukehoban/ecmascript-asyncawait/"},"children":[{"type":"text","value":"ECMAScript's Proposal for async/await","position":{"start":{"line":323,"column":4,"offset":10897},"end":{"line":323,"column":41,"offset":10934}}}],"position":{"start":{"line":323,"column":3,"offset":10896},"end":{"line":323,"column":95,"offset":10988}}}],"position":{"start":{"line":323,"column":1,"offset":10894},"end":{"line":323,"column":95,"offset":10988}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://esdiscuss.org/notes/2014-01-30#async-await"},"children":[{"type":"text","value":"ES Meeting Notes discussing on async/await","position":{"start":{"line":324,"column":4,"offset":10993},"end":{"line":324,"column":46,"offset":11035}}}],"position":{"start":{"line":324,"column":3,"offset":10992},"end":{"line":324,"column":99,"offset":11088}}}],"position":{"start":{"line":324,"column":1,"offset":10990},"end":{"line":324,"column":99,"offset":11088}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://esdiscuss.org/topic/does-async-await-solve-a-real-problem"},"children":[{"type":"text","value":"Does async/await Solve a Real Problem?","position":{"start":{"line":325,"column":4,"offset":11093},"end":{"line":325,"column":42,"offset":11131}}}],"position":{"start":{"line":325,"column":3,"offset":11092},"end":{"line":325,"column":110,"offset":11199}}}],"position":{"start":{"line":325,"column":1,"offset":11090},"end":{"line":325,"column":110,"offset":11199}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://thomashunter.name/blog/the-long-road-to-asyncawait-in-javascript/"},"children":[{"type":"text","value":"The Long Road to async/await in JavaScript","position":{"start":{"line":326,"column":4,"offset":11204},"end":{"line":326,"column":46,"offset":11246}}}],"position":{"start":{"line":326,"column":3,"offset":11203},"end":{"line":326,"column":122,"offset":11322}}}],"position":{"start":{"line":326,"column":1,"offset":11201},"end":{"line":326,"column":122,"offset":11322}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.twilio.com/blog/2015/10/asyncawait-the-hero-javascript-deserved.html"},"children":[{"type":"text","value":"async/await: The Hero JavaScript Deserved","position":{"start":{"line":327,"column":4,"offset":11327},"end":{"line":327,"column":45,"offset":11368}}}],"position":{"start":{"line":327,"column":3,"offset":11326},"end":{"line":327,"column":128,"offset":11451}}}],"position":{"start":{"line":327,"column":1,"offset":11324},"end":{"line":327,"column":128,"offset":11451}}},{"type":"text","value":"\n"}],"position":{"start":{"line":321,"column":1,"offset":10783},"end":{"line":327,"column":128,"offset":11451}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":328,"column":1,"offset":11453}}}}